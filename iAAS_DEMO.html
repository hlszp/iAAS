<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: "Industrial Calm" - A calming neutral palette (slate, stone) with a professional blue as primary and subtle, clear colors (teal, amber, crimson) for semantic highlighting in charts. -->
    <!-- Application Structure Plan: A complete overhaul based on the new 8-module design document. The application now features a top navigation bar for switching between all eight centers. This step focuses on fully implementing the "Action Center" (处置中心) with its specified KPIs, interactive alarm list, action modals, and performance analysis charts. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Action Center KPIs -> Goal: Provide an at-a-glance summary of workload and performance -> Viz: KPI cards -> Interaction: Filters update all cards -> Justification: Directly implements the design doc's requirement for a top overview section.
        - Report Info: Alarm Action List -> Goal: Enable detailed operator/engineer actions -> Viz: A detailed HTML table with status badges and action buttons -> Interaction: Buttons trigger modals for single/batch actions -> Justification: Forms the core interactive element of the module.
        - Report Info: Action Modals -> Goal: Standardize data entry for causes, actions, and verification -> Viz: Two separate modal dialogs with form inputs -> Interaction: Form submission (simulated) -> Justification: Provides a structured workflow for the alarm lifecycle as specified.
        - Report Info: Timely Response Analysis -> Goal: Analyze team performance -> Viz: Bar charts and summary tables -> Interaction: Filters update the analysis -> Justification: Implements the requirement for built-in performance analysis within the Action Center.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <title>先进过程报警分析与治理系统 - AI增强原型 v3.9 (已修复)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2.3.0/dist/chartjs-chart-treemap.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f0f4f8; }
        .chart-container { position: relative; width: 100%; height: 320px; }
        .small-chart-container { position: relative; width: 100%; height: 280px; }
        .analysis-chart-container { position: relative; width: 100%; height: 300px; }

        /* 左侧导航样式 */
        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #1e293b 0%, #334155 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        .sidebar-collapsed { width: 60px; }
        .nav-item {
            transition: all 0.2s ease-in-out;
            border-left: 3px solid transparent;
            position: relative;
        }
        .nav-item:hover {
            background-color: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
        }
        .nav-item.active {
            background-color: rgba(59, 130, 246, 0.2);
            border-left-color: #3b82f6;
            color: #3b82f6;
        }
        .nav-item.active::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 0;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid #f1f5f9;
        }
        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .nav-text {
            transition: opacity 0.3s ease;
        }
        .sidebar-collapsed .nav-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
        }
        .toggle-btn {
            transition: transform 0.3s ease;
        }
        .toggle-btn:hover {
            transform: scale(1.1);
        }

        /* 主内容区域 */
        .main-content {
            transition: margin-left 0.3s ease;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                z-index: 40;
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0 !important;
            }
            .mobile-overlay {
                position: fixed;
                inset: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 35;
            }
        }

        .kpi-card { transition: all 0.2s ease-in-out; }
        .kpi-card:hover { transform: translateY(-4px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07); }
        .ratio-up { color: #dc2626; }
        .ratio-down { color: #16a34a; }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        .status-badge { padding: 2px 8px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; }
        .status-new { background-color: #ffedd5; color: #f97316; }
        .status-analyzed { background-color: #dbeafe; color: #2563eb; }
        .status-closed { background-color: #d1fae5; color: #059669; }

        /* 诊断中心标签页样式 */
        .diagnostics-tab-btn {
            border-bottom-color: transparent;
            color: #64748b;
            transition: all 0.2s ease;
        }
        .diagnostics-tab-btn:hover {
            color: #334155;
            border-bottom-color: #cbd5e1;
        }
        .diagnostics-tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        .diagnostics-tab-content {
            min-height: 400px;
        }

        /* 评估中心标签页样式 */
        .evaluation-tab-btn {
            border-bottom-color: transparent;
            color: #64748b;
            transition: all 0.2s ease;
        }
        .evaluation-tab-btn:hover {
            color: #334155;
            border-bottom-color: #cbd5e1;
        }
        .evaluation-tab-btn.active {
            color: #059669;
            border-bottom-color: #059669;
        }
        .evaluation-tab-content {
            min-height: 400px;
        }

        /* 健康度等级样式 */
        .health-excellent { color: #059669; font-weight: bold; }
        .health-good { color: #0891b2; font-weight: bold; }
        .health-fair { color: #d97706; font-weight: bold; }
        .health-poor { color: #dc2626; font-weight: bold; }

        /* 风险等级样式 */
        .risk-high { color: #dc2626; background-color: #fef2f2; }
        .risk-medium { color: #d97706; background-color: #fffbeb; }
        .risk-low { color: #059669; background-color: #f0fdf4; }

        /* 基础配置标签页样式 */
        .config-tab-btn {
            border-bottom-color: transparent;
            color: #64748b;
            transition: all 0.2s ease;
        }
        .config-tab-btn:hover {
            color: #334155;
            border-bottom-color: #cbd5e1;
        }
        .config-tab-btn.active {
            color: #0891b2;
            border-bottom-color: #0891b2;
        }
        .config-tab-content {
            min-height: 400px;
        }

        /* 工厂模型树形结构样式 */
        .factory-node {
            padding: 8px 12px;
            margin: 2px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        .factory-node:hover {
            background-color: #f1f5f9;
            border-left-color: #0891b2;
        }
        .factory-node.selected {
            background-color: #e0f2fe;
            border-left-color: #0891b2;
        }
        .factory-node.level-0 { margin-left: 0; font-weight: 600; }
        .factory-node.level-1 { margin-left: 20px; font-weight: 500; }
        .factory-node.level-2 { margin-left: 40px; }
        .factory-node.level-3 { margin-left: 60px; font-size: 0.875rem; }
    </style>
</head>
<body class="text-slate-700">
    <div class="min-h-screen bg-slate-100 flex">
        <!-- 左侧导航栏 -->
        <aside id="sidebar" class="sidebar fixed left-0 top-0 h-full z-30">
            <!-- 头部 -->
            <div class="p-4 border-b border-slate-600">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div class="nav-text">
                            <h2 class="text-white font-bold text-sm">AAS系统</h2>
                            <p class="text-slate-300 text-xs">v3.9</p>
                        </div>
                    </div>
                    <button id="sidebar-toggle" class="toggle-btn text-slate-300 hover:text-white p-1">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- 导航菜单 -->
            <nav class="p-2">
                <div class="space-y-1">
                    <button data-target="monitoring" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg active">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span class="nav-text font-medium">监控中心</span>
                    </button>

                    <button data-target="action" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">处置中心</span>
                    </button>

                    <button data-target="analysis" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                        <span class="nav-text font-medium">分析中心</span>
                    </button>

                    <button data-target="diagnostics" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">诊断中心</span>
                    </button>

                    <button data-target="evaluation" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">评估中心</span>
                    </button>

                    <button data-target="reporting" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">报告中心</span>
                    </button>

                    <button data-target="history" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">历史记录</span>
                    </button>

                    <button data-target="config" class="nav-item w-full flex items-center px-3 py-3 text-left text-slate-200 hover:text-white rounded-lg">
                        <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                        </svg>
                        <span class="nav-text font-medium">基础配置</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- 主内容区域 -->
        <div class="main-content flex-1" style="margin-left: 240px;">
            <!-- 顶部标题栏 -->
            <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-20">
                <div class="px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <!-- 移动端菜单按钮 -->
                            <button id="mobile-menu-btn" class="md:hidden mr-4 p-2 text-slate-600 hover:text-slate-800">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                            </button>
                            <div>
                                <h1 class="text-xl md:text-2xl font-bold text-slate-800">先进过程报警分析与治理系统</h1>
                                <p class="text-sm text-slate-500 mt-1 hidden md:block">Advanced Alarm Analysis & Management System</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-slate-500 hidden md:inline">AI增强原型 v3.9</span>
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-medium">A</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 主内容 -->
            <main class="p-6">
            <!-- Monitoring Center Section -->
            <div id="monitoring-section">
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <div class="flex items-center gap-2">
                            <label for="monitoring-time-filter" class="font-semibold text-sm">时间范围:</label>
                            <select id="monitoring-time-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="day">近24小时</option>
                                <option value="week" selected>最近7天</option>
                                <option value="month">最近30天</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="monitoring-unit-filter" class="font-semibold text-sm">工厂/装置:</label>
                            <select id="monitoring-unit-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="all">全厂</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                    </div>
                </div>
                 <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4 mb-6">
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">总报警数</h4><p id="kpi-total-alarms" class="text-3xl font-bold text-slate-800 mt-2">0</p><p id="kpi-total-alarms-ratio" class="text-xs"></p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">小时报警数</h4><p id="kpi-hourly-alarms" class="text-3xl font-bold text-slate-800 mt-2">0</p><p id="kpi-hourly-alarms-ratio" class="text-xs"></p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">峰值报警率</h4><p id="kpi-peak-rate" class="text-3xl font-bold text-slate-800 mt-2">0</p><p class="text-xs text-slate-500">/ 10min (基准: &lt;10)</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">滋扰报警数</h4><p id="kpi-nuisance-alarms" class="text-3xl font-bold text-amber-600 mt-2">0</p><p id="kpi-nuisance-alarms-ratio" class="text-xs"></p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">滋扰报警占比</h4><p id="kpi-nuisance-percent" class="text-3xl font-bold text-amber-600 mt-2">0%</p><p class="text-xs text-slate-500">目标: &lt;5%</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">报警泛滥次数</h4><p id="kpi-flood-count" class="text-3xl font-bold text-red-600 mt-2">0</p><p class="text-xs text-slate-500">/ 10min &gt; 10条</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">报警泛滥比例</h4><p id="kpi-flood-percent" class="text-3xl font-bold text-red-600 mt-2">0%</p><p class="text-xs text-slate-500">目标: &lt;1%</p></div>
                </div>

                <!-- AI智能分析区域 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">智能监控分析</h3>
                        <button id="ai-monitoring-analysis-btn" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:from-purple-700 hover:to-blue-700 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            AI智能分析
                        </button>
                    </div>
                    <div id="ai-monitoring-insights" class="hidden">
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-blue-800 mb-2">AI智能洞察</h4>
                                    <div id="ai-monitoring-insights-content" class="text-sm text-blue-700 whitespace-pre-line">
                                        正在分析当前监控数据...
                                    </div>
                                </div>
                                <button id="close-ai-monitoring-insights" class="text-blue-600 hover:text-blue-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                    <div class="lg:col-span-3 bg-white p-4 rounded-lg shadow-sm"><h3 class="font-bold mb-4 text-center">报警趋势及预测</h3><div class="chart-container"><canvas id="trendChart"></canvas></div></div>
                    <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-sm"><h3 class="font-bold mb-4 text-center">报警优先级分布</h3><div class="chart-container"><canvas id="priorityChart"></canvas></div></div>
                    <div class="lg:col-span-2 bg-white p-4 rounded-lg shadow-sm"><h3 class="font-bold mb-4 text-center">Top 10 "坏苹果" - 报警频率</h3><div class="chart-container"><canvas id="topAlarmsChart"></canvas></div></div>
                    <div class="lg:col-span-3 bg-white p-4 rounded-lg shadow-sm"><h3 class="font-bold mb-4 text-center">各装置报警数量 (树图)</h3><div class="chart-container"><canvas id="treemapChart"></canvas></div></div>
                </div>
            </div>

            <!-- Action Center Section -->
            <div id="action-section" class="hidden">
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <div class="flex items-center gap-2">
                            <label for="action-time-filter" class="font-semibold text-sm">时间范围:</label>
                            <select id="action-time-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="day">近24小时</option>
                                <option value="week" selected>最近7天</option>
                                <option value="month">最近30天</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="action-unit-filter" class="font-semibold text-sm">工厂/装置:</label>
                            <select id="action-unit-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="all">全厂</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Action Center KPIs -->
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6">
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">总报警数</h4><p id="action-kpi-total" class="text-3xl font-bold text-slate-800 mt-2">0</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">待处置分析</h4><p id="action-kpi-pending" class="text-3xl font-bold text-amber-600 mt-2">0</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">超时确认</h4><p id="action-kpi-overdue-ack" class="text-3xl font-bold text-red-600 mt-2">0</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">超时处置</h4><p id="action-kpi-overdue-res" class="text-3xl font-bold text-red-600 mt-2">0</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">及时确认率</h4><p id="action-kpi-ack-rate" class="text-3xl font-bold text-green-600 mt-2">0%</p></div>
                    <div class="kpi-card bg-white p-4 rounded-lg shadow-sm text-center"><h4 class="text-sm font-semibold text-slate-500">及时处置率</h4><p id="action-kpi-res-rate" class="text-3xl font-bold text-green-600 mt-2">0%</p></div>
                </div>

                <!-- AI智能处置建议区域 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold">智能处置建议</h3>
                        <button id="ai-action-analysis-btn" class="bg-gradient-to-r from-green-600 to-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:from-green-700 hover:to-blue-700 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            获取AI建议
                        </button>
                    </div>
                    <div id="ai-action-insights" class="hidden">
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4">
                            <div class="flex items-start gap-3">
                                <div class="w-8 h-8 bg-gradient-to-r from-green-600 to-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-green-800 mb-2">AI处置建议</h4>
                                    <div id="ai-action-insights-content" class="text-sm text-green-700 whitespace-pre-line">
                                        正在分析当前报警并生成处置建议...
                                    </div>
                                </div>
                                <button id="close-ai-action-insights" class="text-green-600 hover:text-green-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action List -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">报警处置列表</h3>
                        <button id="batch-action-btn" class="bg-sky-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-sky-700 disabled:bg-slate-300" disabled>批量处置</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="p-2"><input type="checkbox" id="select-all-alarms"></th>
                                    <th class="p-2">标签位号</th>
                                    <th class="p-2">报警内容</th>
                                    <th class="p-2">报警时间</th>
                                    <th class="p-2">状态</th>
                                    <th class="p-2">操作</th>
                                </tr>
                            </thead>
                            <tbody id="action-list-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Analysis Area -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">各装置及时确认率分析</h3>
                        <div class="small-chart-container"><canvas id="ackRateChart"></canvas></div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">各装置及时处置率分析</h3>
                        <div class="small-chart-container"><canvas id="resRateChart"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Analysis Center Section -->
            <div id="analysis-section" class="hidden">
                <!-- 筛选条件区 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <div class="flex items-center gap-2">
                            <label for="analysis-time-filter" class="font-semibold text-sm">时间范围:</label>
                            <select id="analysis-time-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="day">近24小时</option>
                                <option value="week" selected>最近7天</option>
                                <option value="month">最近30天</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="analysis-unit-filter" class="font-semibold text-sm">工厂/装置:</label>
                            <select id="analysis-unit-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="all">全厂</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="analysis-dimension-filter" class="font-semibold text-sm">分析维度:</label>
                            <select id="analysis-dimension-filter" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="daily">按日</option>
                                <option value="weekly" selected>按周</option>
                                <option value="monthly">按月</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 趋势分析图表网格 -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- 报警数量趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">报警数量趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="alarmCountTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 滋扰报警趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">滋扰报警趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="nuisanceAlarmTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- TOP10趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">TOP10报警趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="top10TrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 10min峰值趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">10min峰值趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="peakTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 报警泛滥趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">报警泛滥趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="floodTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 报警确认趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">报警确认趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="ackTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 报警处置趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">报警处置趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="resolveTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- 处置时长趋势 -->
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h3 class="font-bold mb-4 text-center">处置时长趋势</h3>
                        <div class="analysis-chart-container">
                            <canvas id="durationTrendChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- 综合分析摘要 -->
                <div class="mt-6 bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="font-bold mb-4">趋势分析摘要</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">报警总体趋势</h4>
                            <p id="alarm-trend-summary" class="text-sm text-blue-600">分析中...</p>
                        </div>
                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-amber-800 mb-2">滋扰报警状况</h4>
                            <p id="nuisance-trend-summary" class="text-sm text-amber-600">分析中...</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-2">处置效率</h4>
                            <p id="efficiency-trend-summary" class="text-sm text-green-600">分析中...</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-purple-800 mb-2">预测建议</h4>
                            <p id="prediction-summary" class="text-sm text-purple-600">分析中...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other sections placeholders -->
            <!-- Diagnostics Center Section -->
            <div id="diagnostics-section" class="hidden">
                <!-- 筛选条件区 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <div class="flex items-center gap-2">
                            <label for="diagnostics-time-filter" class="font-semibold text-sm">时间范围:</label>
                            <select id="diagnostics-time-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="day">近24小时</option>
                                <option value="week" selected>最近7天</option>
                                <option value="month">最近30天</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="diagnostics-unit-filter" class="font-semibold text-sm">工厂/装置:</label>
                            <select id="diagnostics-unit-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="all">全厂</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 诊断分析标签页 -->
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="border-b border-slate-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm active" data-tab="intermittent">
                                间歇报警分析
                            </button>
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="flash">
                                瞬闪报警分析
                            </button>
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="stale">
                                陈旧报警分析
                            </button>
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="nuisance">
                                滋扰报警综合
                            </button>
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="top">
                                TOP报警分析
                            </button>
                            <button class="diagnostics-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="shelve">
                                报警搁置管理
                            </button>
                        </nav>
                    </div>

                    <!-- 间歇报警分析 -->
                    <div id="intermittent-tab" class="diagnostics-tab-content p-6">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">间歇报警分析</h3>
                            <p class="text-sm text-slate-600 mb-4">定义：每分钟三个及以上的报警的标签界定为间歇报警</p>

                            <!-- 图表区域 -->
                            <div class="bg-slate-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold mb-3">前10个间歇报警标签</h4>
                                <div class="analysis-chart-container">
                                    <canvas id="intermittentChart"></canvas>
                                </div>
                            </div>

                            <!-- 列表区域 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">排名</th>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">间歇报警次数</th>
                                            <th class="p-3">总持续时长</th>
                                            <th class="p-3">平均报警时长</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="intermittent-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 瞬闪报警分析 -->
                    <div id="flash-tab" class="diagnostics-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">瞬闪报警分析</h3>
                            <p class="text-sm text-slate-600 mb-4">定义：报警持续时间小于等于3秒的报警界定为瞬闪报警</p>

                            <!-- 图表区域 -->
                            <div class="bg-slate-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold mb-3">前10个瞬闪报警标签</h4>
                                <div class="analysis-chart-container">
                                    <canvas id="flashChart"></canvas>
                                </div>
                            </div>

                            <!-- 列表区域 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">排名</th>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">瞬闪报警次数</th>
                                            <th class="p-3">总持续时长</th>
                                            <th class="p-3">平均报警时长</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="flash-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 陈旧报警分析 -->
                    <div id="stale-tab" class="diagnostics-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">陈旧报警分析</h3>
                            <p class="text-sm text-slate-600 mb-4">定义：持续时间大于等于24小时报警界定为陈旧报警</p>

                            <!-- 图表区域 -->
                            <div class="bg-slate-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold mb-3">每日陈旧报警数量</h4>
                                <div class="analysis-chart-container">
                                    <canvas id="staleChart"></canvas>
                                </div>
                            </div>

                            <!-- 列表区域 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">报警标签</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">报警开始时间</th>
                                            <th class="p-3">报警结束时间</th>
                                            <th class="p-3">报警持续时间</th>
                                            <th class="p-3">状态</th>
                                        </tr>
                                    </thead>
                                    <tbody id="stale-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 滋扰报警综合分析 -->
                    <div id="nuisance-tab" class="diagnostics-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">滋扰报警综合分析</h3>
                            <p class="text-sm text-slate-600 mb-4">包含：间歇报警、瞬闪报警、陈旧报警</p>

                            <!-- 统计卡片 -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-amber-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-amber-800">滋扰报警次数</h4>
                                    <p id="nuisance-count" class="text-2xl font-bold text-amber-600 mt-2">0</p>
                                </div>
                                <div class="bg-orange-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-orange-800">累计时长</h4>
                                    <p id="nuisance-duration" class="text-2xl font-bold text-orange-600 mt-2">0小时</p>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-red-800">数量占比</h4>
                                    <p id="nuisance-count-ratio" class="text-2xl font-bold text-red-600 mt-2">0%</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-purple-800">时长占比</h4>
                                    <p id="nuisance-time-ratio" class="text-2xl font-bold text-purple-600 mt-2">0%</p>
                                </div>
                            </div>

                            <!-- 趋势图 -->
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-3">滋扰报警趋势</h4>
                                <div class="analysis-chart-container">
                                    <canvas id="nuisanceTrendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TOP报警分析 -->
                    <div id="top-tab" class="diagnostics-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">TOP报警分析</h3>
                            <div class="flex items-center gap-4 mb-4">
                                <p class="text-sm text-slate-600">报警次数排名前N的标签为TOP报警标签</p>
                                <div class="flex items-center gap-2">
                                    <label for="top-n-select" class="text-sm font-medium">排名数量:</label>
                                    <select id="top-n-select" class="bg-slate-100 border-slate-300 rounded-md p-1 text-sm">
                                        <option value="5">前5名</option>
                                        <option value="10" selected>前10名</option>
                                        <option value="15">前15名</option>
                                        <option value="20">前20名</option>
                                    </select>
                                </div>
                            </div>

                            <!-- 列表区域 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">排名</th>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">报警次数</th>
                                            <th class="p-3">累计时长</th>
                                            <th class="p-3">次数占比</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="top-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 报警搁置管理 -->
                    <div id="shelve-tab" class="diagnostics-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">报警搁置管理</h3>
                            <p class="text-sm text-slate-600 mb-4">管理临时搁置报警的标签，搁置的报警在搁置时间周期内不参与统计</p>

                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <button id="add-shelve-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">
                                        新增搁置
                                    </button>
                                </div>
                                <div class="text-sm text-slate-500">
                                    当前搁置标签: <span id="shelved-count" class="font-semibold">0</span> 个
                                </div>
                            </div>

                            <!-- 搁置列表 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">搁置开始时间</th>
                                            <th class="p-3">搁置结束时间</th>
                                            <th class="p-3">搁置原因</th>
                                            <th class="p-3">申请人</th>
                                            <th class="p-3">审批人</th>
                                            <th class="p-3">状态</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="shelve-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 优化治理建议 -->
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-lg font-bold mb-4">优化治理建议</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-amber-800 mb-3">间歇报警治理建议</h4>
                            <div id="intermittent-suggestions" class="text-sm text-amber-700 space-y-2">
                                <p>• 检查传感器信号稳定性</p>
                                <p>• 调整报警死区设置</p>
                                <p>• 优化控制回路参数</p>
                                <p>• 考虑增加信号滤波</p>
                            </div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-3">瞬闪报警治理建议</h4>
                            <div id="flash-suggestions" class="text-sm text-blue-700 space-y-2">
                                <p>• 增加报警延时设置</p>
                                <p>• 检查信号线路干扰</p>
                                <p>• 优化报警逻辑</p>
                                <p>• 考虑使用报警抑制</p>
                            </div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-red-800 mb-3">陈旧报警治理建议</h4>
                            <div id="stale-suggestions" class="text-sm text-red-700 space-y-2">
                                <p>• 及时处理长期报警</p>
                                <p>• 检查设备运行状态</p>
                                <p>• 评估报警设定值合理性</p>
                                <p>• 建立定期巡检机制</p>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-purple-800 mb-3">TOP报警治理建议</h4>
                            <div id="top-suggestions" class="text-sm text-purple-700 space-y-2">
                                <p>• 优先处理高频报警</p>
                                <p>• 分析报警根本原因</p>
                                <p>• 制定专项治理方案</p>
                                <p>• 建立长效管理机制</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Evaluation Center Section -->
            <div id="evaluation-section" class="hidden">
                <!-- 筛选条件区 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex items-center justify-between flex-wrap gap-4">
                    <div class="flex items-center gap-4 flex-wrap">
                        <div class="flex items-center gap-2">
                            <label for="evaluation-time-filter" class="font-semibold text-sm">评估周期:</label>
                            <select id="evaluation-time-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="week">最近7天</option>
                                <option value="month" selected>最近30天</option>
                                <option value="quarter">最近90天</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <label for="evaluation-unit-filter" class="font-semibold text-sm">评估范围:</label>
                            <select id="evaluation-unit-filter" class="filter-control bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                <option value="all">全厂</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 评估功能标签页 -->
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="border-b border-slate-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <button class="evaluation-tab-btn py-4 px-1 border-b-2 font-medium text-sm active" data-tab="health">
                                性能健康度评估
                            </button>
                            <button class="evaluation-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="maturity">
                                管理成熟度分析
                            </button>
                            <button class="evaluation-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="audit">
                                参数审计
                            </button>
                        </nav>
                    </div>

                    <!-- 性能健康度评估 -->
                    <div id="health-tab" class="evaluation-tab-content p-6">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">性能健康度评估</h3>
                            <p class="text-sm text-slate-600 mb-6">基于6个关键指标通过加权平均计算综合性能指数</p>

                            <!-- 评估指标说明 -->
                            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold text-blue-800 mb-3">评估指标体系</h4>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                    <div class="text-blue-700">
                                        <span class="font-medium">日报警率</span>
                                        <p class="text-xs">权重: 20%</p>
                                    </div>
                                    <div class="text-blue-700">
                                        <span class="font-medium">小时报警扰动率</span>
                                        <p class="text-xs">权重: 15%</p>
                                    </div>
                                    <div class="text-blue-700">
                                        <span class="font-medium">10min报警峰值</span>
                                        <p class="text-xs">权重: 15%</p>
                                    </div>
                                    <div class="text-blue-700">
                                        <span class="font-medium">报警泛滥比例</span>
                                        <p class="text-xs">权重: 20%</p>
                                    </div>
                                    <div class="text-blue-700">
                                        <span class="font-medium">滋扰报警比例</span>
                                        <p class="text-xs">权重: 20%</p>
                                    </div>
                                    <div class="text-blue-700">
                                        <span class="font-medium">TOP10报警比例</span>
                                        <p class="text-xs">权重: 10%</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 装置健康度雷达图和排名 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">装置性能雷达图</h4>
                                    <div class="flex items-center gap-2 mb-3">
                                        <label for="radar-unit-select" class="text-sm font-medium">选择装置:</label>
                                        <select id="radar-unit-select" class="bg-white border-slate-300 rounded-md p-1 text-sm">
                                            <option value="MTO">MTO装置</option>
                                            <option value="R-2002">R-2002单元</option>
                                            <option value="C-2001">C-2001单元</option>
                                        </select>
                                    </div>
                                    <div class="analysis-chart-container">
                                        <canvas id="healthRadarChart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">装置性能排名</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="healthRankingChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- 健康度评分详情 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">装置名称</th>
                                            <th class="p-3">综合得分</th>
                                            <th class="p-3">日报警率</th>
                                            <th class="p-3">扰动率</th>
                                            <th class="p-3">峰值</th>
                                            <th class="p-3">泛滥比例</th>
                                            <th class="p-3">滋扰比例</th>
                                            <th class="p-3">TOP10比例</th>
                                            <th class="p-3">健康等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="health-score-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 管理成熟度分析 -->
                    <div id="maturity-tab" class="evaluation-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">管理成熟度分析</h3>
                            <p class="text-sm text-slate-600 mb-6">基于性能指标、趋势变化、确认处置情况等5个维度评估管理成熟度</p>

                            <!-- 成熟度指标说明 -->
                            <div class="bg-green-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold text-green-800 mb-3">成熟度评估体系</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 text-sm">
                                    <div class="text-green-700">
                                        <span class="font-medium">性能指数</span>
                                        <p class="text-xs">权重: 25%</p>
                                        <p class="text-xs">基于健康度评估结果</p>
                                    </div>
                                    <div class="text-green-700">
                                        <span class="font-medium">报警数量下降率</span>
                                        <p class="text-xs">权重: 25%</p>
                                        <p class="text-xs">环比变化趋势</p>
                                    </div>
                                    <div class="text-green-700">
                                        <span class="font-medium">及时确认率</span>
                                        <p class="text-xs">权重: 20%</p>
                                        <p class="text-xs">响应及时性</p>
                                    </div>
                                    <div class="text-green-700">
                                        <span class="font-medium">及时处置率</span>
                                        <p class="text-xs">权重: 20%</p>
                                        <p class="text-xs">处置及时性</p>
                                    </div>
                                    <div class="text-green-700">
                                        <span class="font-medium">处置分析率</span>
                                        <p class="text-xs">权重: 10%</p>
                                        <p class="text-xs">分析完成度</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 成熟度评估结果 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">成熟度雷达图</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="maturityRadarChart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">成熟度趋势</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="maturityTrendChart"></canvas>
                                    </div>
                                </div>
                            </div>

                            <!-- 成熟度评分详情 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">装置名称</th>
                                            <th class="p-3">成熟度得分</th>
                                            <th class="p-3">性能指数</th>
                                            <th class="p-3">下降率</th>
                                            <th class="p-3">确认率</th>
                                            <th class="p-3">处置率</th>
                                            <th class="p-3">分析率</th>
                                            <th class="p-3">成熟度等级</th>
                                        </tr>
                                    </thead>
                                    <tbody id="maturity-score-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 参数审计 -->
                    <div id="audit-tab" class="evaluation-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">参数审计</h3>
                            <p class="text-sm text-slate-600 mb-6">通过对比历史报警记录与报警参数数据库，自动发现设计与实际运行之间的偏差</p>

                            <!-- 审计统计 -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-blue-800">审计标签总数</h4>
                                    <p id="audit-total-count" class="text-2xl font-bold text-blue-600 mt-2">0</p>
                                </div>
                                <div class="bg-red-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-red-800">发现问题数</h4>
                                    <p id="audit-issue-count" class="text-2xl font-bold text-red-600 mt-2">0</p>
                                </div>
                                <div class="bg-amber-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-amber-800">高风险问题</h4>
                                    <p id="audit-high-risk-count" class="text-2xl font-bold text-amber-600 mt-2">0</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg text-center">
                                    <h4 class="text-sm font-semibold text-green-800">合规率</h4>
                                    <p id="audit-compliance-rate" class="text-2xl font-bold text-green-600 mt-2">0%</p>
                                </div>
                            </div>

                            <!-- 审计结果分类 -->
                            <div class="bg-slate-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold mb-3">审计问题分布</h4>
                                <div class="analysis-chart-container">
                                    <canvas id="auditIssueChart"></canvas>
                                </div>
                            </div>

                            <!-- 筛选和操作区 -->
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <label for="audit-issue-filter" class="text-sm font-medium">问题类型:</label>
                                        <select id="audit-issue-filter" class="bg-white border-slate-300 rounded-md p-1 text-sm">
                                            <option value="all">全部问题</option>
                                            <option value="threshold">阈值不一致</option>
                                            <option value="priority">优先级不一致</option>
                                            <option value="unmanaged">未纳管</option>
                                            <option value="config">配置错误</option>
                                        </select>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <label for="audit-risk-filter" class="text-sm font-medium">风险等级:</label>
                                        <select id="audit-risk-filter" class="bg-white border-slate-300 rounded-md p-1 text-sm">
                                            <option value="all">全部等级</option>
                                            <option value="high">高风险</option>
                                            <option value="medium">中风险</option>
                                            <option value="low">低风险</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button id="export-audit-btn" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-green-700">
                                        导出审计报告
                                    </button>
                                    <button id="refresh-audit-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">
                                        重新审计
                                    </button>
                                </div>
                            </div>

                            <!-- 审计结果列表 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">不一致项目</th>
                                            <th class="p-3">记录值</th>
                                            <th class="p-3">设置值</th>
                                            <th class="p-3">风险等级</th>
                                            <th class="p-3">风险提示</th>
                                            <th class="p-3">建议措施</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="audit-result-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 评估总结和建议 -->
                <div class="bg-white p-6 rounded-lg shadow-sm">
                    <h3 class="text-lg font-bold mb-4">评估总结与改进建议</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-3">性能健康度总结</h4>
                            <div id="health-summary" class="text-sm text-blue-700 space-y-2">
                                <p>• 整体健康度评估结果</p>
                                <p>• 主要问题识别</p>
                                <p>• 改进优先级建议</p>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-green-800 mb-3">管理成熟度总结</h4>
                            <div id="maturity-summary" class="text-sm text-green-700 space-y-2">
                                <p>• 管理成熟度水平</p>
                                <p>• 管理短板分析</p>
                                <p>• 能力提升建议</p>
                            </div>
                        </div>
                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-amber-800 mb-3">参数审计总结</h4>
                            <div id="audit-summary" class="text-sm text-amber-700 space-y-2">
                                <p>• 参数一致性状况</p>
                                <p>• 高风险问题汇总</p>
                                <p>• 整改措施建议</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Reporting Center Section -->
            <div id="reporting-section" class="hidden">
                <!-- 报告生成控制区 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-4 flex-wrap">
                            <div class="flex items-center gap-2">
                                <label for="report-type" class="font-semibold text-sm">报告类型:</label>
                                <select id="report-type" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                    <option value="weekly">周报告</option>
                                    <option value="monthly" selected>月报告</option>
                                    <option value="quarterly">季度报告</option>
                                    <option value="custom">自定义周期</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <label for="report-period" class="font-semibold text-sm">报告周期:</label>
                                <input type="date" id="report-start-date" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm" value="2024-01-01">
                                <span class="text-sm text-slate-500">至</span>
                                <input type="date" id="report-end-date" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm" value="2024-01-31">
                            </div>
                            <div class="flex items-center gap-2">
                                <label for="report-scope" class="font-semibold text-sm">报告范围:</label>
                                <select id="report-scope" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                    <option value="all">全厂</option>
                                    <option value="MTO">MTO装置</option>
                                    <option value="R-2002">R-2002单元</option>
                                    <option value="C-2001">C-2001单元</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="generate-report-btn" class="bg-blue-600 text-white px-6 py-2 rounded-md text-sm font-semibold hover:bg-blue-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                生成报告
                            </button>
                            <button id="export-report-btn" class="bg-green-600 text-white px-6 py-2 rounded-md text-sm font-semibold hover:bg-green-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                导出报告
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 报告内容区 -->
                <div class="bg-white rounded-lg shadow-sm">
                    <!-- 报告头部 -->
                    <div class="border-b border-slate-200 p-6">
                        <div class="text-center">
                            <h1 id="report-title" class="text-2xl font-bold text-slate-800 mb-2">报警管理月度分析报告</h1>
                            <p id="report-subtitle" class="text-slate-600">2024年1月 - 全厂报警系统运行分析</p>
                            <div class="flex justify-between items-center mt-4 text-sm text-slate-500">
                                <span>生成时间: <span id="report-generate-time">2024-02-01 10:30:00</span></span>
                                <span>报告编号: <span id="report-number">RPT-2024-001</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- 报告正文 -->
                    <div class="p-6">
                        <!-- 执行摘要 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                执行摘要
                            </h2>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <div id="executive-summary" class="prose prose-sm max-w-none">
                                    <p class="mb-3">本报告期内，全厂报警系统整体运行稳定，主要指标表现如下：</p>
                                    <ul class="list-disc list-inside space-y-1 text-sm">
                                        <li>总报警数量: <strong id="summary-total-alarms">1,245</strong> 条，较上期下降 <strong class="text-green-600">8.5%</strong></li>
                                        <li>滋扰报警占比: <strong id="summary-nuisance-ratio">15.2%</strong>，较上期下降 <strong class="text-green-600">2.3%</strong></li>
                                        <li>及时确认率: <strong id="summary-ack-rate">92.1%</strong>，较上期提升 <strong class="text-green-600">3.2%</strong></li>
                                        <li>及时处置率: <strong id="summary-resolve-rate">87.6%</strong>，较上期提升 <strong class="text-green-600">1.8%</strong></li>
                                        <li>系统健康度: <strong id="summary-health-score">75.3</strong> 分，评级为 <strong class="text-blue-600">良好</strong></li>
                                    </ul>
                                </div>
                            </div>
                        </section>

                        <!-- 核心指标表现 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                                </svg>
                                核心指标表现
                            </h2>

                            <!-- KPI卡片 -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-gradient-to-r from-blue-500 to-blue-600 p-4 rounded-lg text-white">
                                    <h3 class="text-sm font-medium opacity-90">总报警数</h3>
                                    <p id="kpi-total-alarms" class="text-2xl font-bold mt-1">1,245</p>
                                    <p class="text-xs opacity-75 mt-1">↓ 8.5% vs 上期</p>
                                </div>
                                <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-4 rounded-lg text-white">
                                    <h3 class="text-sm font-medium opacity-90">滋扰报警率</h3>
                                    <p id="kpi-nuisance-rate" class="text-2xl font-bold mt-1">15.2%</p>
                                    <p class="text-xs opacity-75 mt-1">↓ 2.3% vs 上期</p>
                                </div>
                                <div class="bg-gradient-to-r from-green-500 to-green-600 p-4 rounded-lg text-white">
                                    <h3 class="text-sm font-medium opacity-90">及时确认率</h3>
                                    <p id="kpi-ack-rate" class="text-2xl font-bold mt-1">92.1%</p>
                                    <p class="text-xs opacity-75 mt-1">↑ 3.2% vs 上期</p>
                                </div>
                                <div class="bg-gradient-to-r from-purple-500 to-purple-600 p-4 rounded-lg text-white">
                                    <h3 class="text-sm font-medium opacity-90">系统健康度</h3>
                                    <p id="kpi-health-score" class="text-2xl font-bold mt-1">75.3</p>
                                    <p class="text-xs opacity-75 mt-1">良好</p>
                                </div>
                            </div>

                            <!-- 趋势图表 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">报警数量趋势</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="reportAlarmTrendChart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">处置效率趋势</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="reportEfficiencyChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 主要问题分析 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                                主要问题分析
                            </h2>
                            <div class="space-y-4">
                                <div class="border-l-4 border-red-500 bg-red-50 p-4">
                                    <h4 class="font-semibold text-red-800 mb-2">高频报警问题</h4>
                                    <div id="high-frequency-issues" class="text-sm text-red-700">
                                        <p class="mb-2">发现以下标签存在高频报警问题：</p>
                                        <ul class="list-disc list-inside space-y-1">
                                            <li><strong>80PIC11906</strong> - R-2002反应器压力高报警，报警次数: 156次</li>
                                            <li><strong>80TIC11907</strong> - R-2002反应器温度高报警，报警次数: 134次</li>
                                            <li><strong>80LIC11908</strong> - C-2001分离器液位低报警，报警次数: 98次</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="border-l-4 border-amber-500 bg-amber-50 p-4">
                                    <h4 class="font-semibold text-amber-800 mb-2">滋扰报警问题</h4>
                                    <div id="nuisance-issues" class="text-sm text-amber-700">
                                        <p class="mb-2">滋扰报警主要集中在以下方面：</p>
                                        <ul class="list-disc list-inside space-y-1">
                                            <li>间歇报警: 占滋扰报警的 <strong>45%</strong>，主要原因为控制参数设置不当</li>
                                            <li>瞬闪报警: 占滋扰报警的 <strong>35%</strong>，主要原因为信号干扰</li>
                                            <li>陈旧报警: 占滋扰报警的 <strong>20%</strong>，主要原因为处置不及时</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 原因分析 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-indigo-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                </svg>
                                原因分析
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">根本原因分析</h4>
                                    <div id="root-cause-analysis" class="text-sm space-y-2">
                                        <div class="flex items-start gap-2">
                                            <span class="w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"></span>
                                            <div>
                                                <strong>设备老化问题</strong>
                                                <p class="text-slate-600">R-2002反应器相关设备运行年限较长，传感器精度下降导致频繁报警</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="w-2 h-2 bg-amber-500 rounded-full mt-2 flex-shrink-0"></span>
                                            <div>
                                                <strong>参数设置不当</strong>
                                                <p class="text-slate-600">部分报警阈值设置过于敏感，导致间歇性误报</p>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <span class="w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"></span>
                                            <div>
                                                <strong>操作规程执行</strong>
                                                <p class="text-slate-600">部分操作人员对报警处置流程执行不够规范</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">问题分布分析</h4>
                                    <div class="analysis-chart-container">
                                        <canvas id="reportProblemChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 下一步行动计划 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                                </svg>
                                下一步行动计划
                            </h2>
                            <div class="space-y-4">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-green-800 mb-3">短期行动计划 (1-3个月)</h4>
                                    <div id="short-term-actions" class="space-y-2 text-sm">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-green-600" checked disabled>
                                            <span>优化高频报警标签的阈值设置，减少误报率</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-green-600" disabled>
                                            <span>加强操作人员报警处置培训，提高响应效率</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-green-600" disabled>
                                            <span>建立报警处置标准化流程，规范操作行为</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-blue-800 mb-3">中期行动计划 (3-6个月)</h4>
                                    <div id="medium-term-actions" class="space-y-2 text-sm">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-blue-600" disabled>
                                            <span>更换老化传感器，提升测量精度</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-blue-600" disabled>
                                            <span>实施报警管理系统升级，增强智能分析能力</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-blue-600" disabled>
                                            <span>建立报警绩效考核机制，激励持续改进</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-purple-800 mb-3">长期行动计划 (6-12个月)</h4>
                                    <div id="long-term-actions" class="space-y-2 text-sm">
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-purple-600" disabled>
                                            <span>建立预测性维护体系，减少设备故障报警</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-purple-600" disabled>
                                            <span>引入AI智能诊断技术，提升报警分析水平</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="checkbox" class="rounded text-purple-600" disabled>
                                            <span>建立跨装置报警协同管理机制</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- AI智能摘要 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                AI智能摘要
                            </h2>
                            <div class="bg-gradient-to-r from-purple-50 to-indigo-50 border border-purple-200 rounded-lg p-4">
                                <div class="flex items-start gap-3">
                                    <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                        <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div id="ai-summary" class="text-sm">
                                        <p class="font-medium text-purple-800 mb-2">基于大语言模型的智能分析：</p>
                                        <p class="text-purple-700 mb-3">
                                            本期报警管理整体表现良好，主要指标均有所改善。建议重点关注R-2002装置的高频报警问题，
                                            通过设备维护和参数优化相结合的方式，预计可将该装置报警数量减少30%以上。
                                            同时，建议加强操作人员培训，进一步提升报警处置效率。
                                        </p>
                                        <div class="bg-white bg-opacity-50 rounded p-3">
                                            <p class="text-xs text-purple-600 font-medium">智能建议优先级排序：</p>
                                            <ol class="text-xs text-purple-700 mt-1 space-y-1">
                                                <li>1. 优化80PIC11906压力报警阈值设置 (预期效果: 减少40%误报)</li>
                                                <li>2. 更换80TIC11907温度传感器 (预期效果: 提升测量精度15%)</li>
                                                <li>3. 建立标准化处置流程 (预期效果: 提升处置效率20%)</li>
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- 报告结论 -->
                        <section class="mb-8">
                            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-slate-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                                </svg>
                                报告结论
                            </h2>
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <div id="report-conclusion" class="prose prose-sm max-w-none">
                                    <p class="mb-3">
                                        综合本期报警管理各项指标分析，全厂报警系统运行状况整体良好，主要表现在报警数量下降、
                                        处置效率提升、滋扰报警减少等方面。但仍存在部分装置高频报警、设备老化等问题需要重点关注。
                                    </p>
                                    <p class="mb-3">
                                        建议按照制定的行动计划，分阶段实施改进措施，预计在下一报告期内，系统健康度可提升至80分以上，
                                        滋扰报警占比可降低至12%以下，及时处置率可提升至90%以上。
                                    </p>
                                    <p class="text-sm text-slate-600">
                                        <strong>报告编制:</strong> 报警管理系统 &nbsp;&nbsp;
                                        <strong>审核:</strong> 工程部 &nbsp;&nbsp;
                                        <strong>批准:</strong> 生产部
                                    </p>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
            <!-- History Records Section -->
            <div id="history-section" class="hidden">
                <!-- 操作工具栏 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center gap-4 flex-wrap">
                            <button id="import-history-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                                </svg>
                                导入记录
                            </button>
                            <button id="export-history-btn" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-green-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                </svg>
                                导出记录
                            </button>
                            <button id="batch-calculate-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-purple-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                </svg>
                                批量计算
                            </button>
                            <button id="batch-delete-history-btn" class="bg-red-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-red-700 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                </svg>
                                批量删除
                            </button>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-slate-600">总记录数:</span>
                            <span id="total-records-count" class="text-sm font-semibold text-blue-600">0</span>
                        </div>
                    </div>
                </div>

                <!-- 筛选条件区 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <h3 class="text-lg font-bold mb-4">筛选条件</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label for="history-time-start" class="block text-sm font-medium text-slate-700 mb-1">开始时间</label>
                            <input type="datetime-local" id="history-time-start" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label for="history-time-end" class="block text-sm font-medium text-slate-700 mb-1">结束时间</label>
                            <input type="datetime-local" id="history-time-end" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label for="history-factory-filter" class="block text-sm font-medium text-slate-700 mb-1">工厂模型</label>
                            <select id="history-factory-filter" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                <option value="">全部</option>
                                <option value="MTO">MTO装置</option>
                                <option value="R-2002">R-2002单元</option>
                                <option value="C-2001">C-2001单元</option>
                            </select>
                        </div>
                        <div>
                            <label for="history-tag-filter" class="block text-sm font-medium text-slate-700 mb-1">标签筛选</label>
                            <input type="text" id="history-tag-filter" placeholder="输入标签位号或名称" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                        </div>
                        <div>
                            <label for="history-alarm-type-filter" class="block text-sm font-medium text-slate-700 mb-1">报警类型</label>
                            <select id="history-alarm-type-filter" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                <option value="">全部类型</option>
                                <option value="high">高报警</option>
                                <option value="low">低报警</option>
                                <option value="deviation">偏差报警</option>
                                <option value="system">系统报警</option>
                            </select>
                        </div>
                        <div>
                            <label for="history-alarm-level-filter" class="block text-sm font-medium text-slate-700 mb-1">报警等级</label>
                            <select id="history-alarm-level-filter" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                <option value="">全部等级</option>
                                <option value="1">一级报警</option>
                                <option value="2">二级报警</option>
                                <option value="3">三级报警</option>
                                <option value="4">四级报警</option>
                            </select>
                        </div>
                        <div>
                            <label for="history-status-filter" class="block text-sm font-medium text-slate-700 mb-1">处理状态</label>
                            <select id="history-status-filter" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                <option value="">全部状态</option>
                                <option value="unconfirmed">未确认</option>
                                <option value="confirmed">已确认</option>
                                <option value="resolved">已处置</option>
                                <option value="closed">已关闭</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="apply-history-filter-btn" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">
                                应用筛选
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 统计参与选项 -->
                <div class="bg-white p-4 rounded-lg shadow-sm mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <h3 class="text-lg font-bold">统计参与设置</h3>
                            <div class="flex items-center gap-2">
                                <input type="checkbox" id="include-in-statistics" checked class="rounded">
                                <label for="include-in-statistics" class="text-sm text-slate-700">当前筛选结果参与统计分析</label>
                            </div>
                        </div>
                        <div class="text-sm text-slate-600">
                            当前筛选结果: <span id="filtered-records-count" class="font-semibold text-blue-600">0</span> 条记录
                        </div>
                    </div>
                </div>

                <!-- 历史记录列表 -->
                <div class="bg-white rounded-lg shadow-sm">
                    <div class="p-4 border-b border-slate-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-bold">历史报警记录</h3>
                            <div class="flex items-center gap-2">
                                <span class="text-sm text-slate-600">每页显示:</span>
                                <select id="history-page-size" class="border border-slate-300 rounded-md p-1 text-sm">
                                    <option value="10">10条</option>
                                    <option value="20" selected>20条</option>
                                    <option value="50">50条</option>
                                    <option value="100">100条</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- 表格 -->
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="p-3">
                                        <input type="checkbox" id="select-all-history" class="rounded">
                                    </th>
                                    <th class="p-3">标签位号</th>
                                    <th class="p-3">标签名称</th>
                                    <th class="p-3">阈值</th>
                                    <th class="p-3">触发值</th>
                                    <th class="p-3">单位</th>
                                    <th class="p-3">报警内容</th>
                                    <th class="p-3">报警级别</th>
                                    <th class="p-3">报警时间</th>
                                    <th class="p-3">确认时间</th>
                                    <th class="p-3">恢复时间</th>
                                    <th class="p-3">持续时间</th>
                                    <th class="p-3">处置状态</th>
                                    <th class="p-3">数据入库时间</th>
                                    <th class="p-3">操作</th>
                                </tr>
                            </thead>
                            <tbody id="history-records-list"></tbody>
                        </table>
                    </div>

                    <!-- 分页 -->
                    <div class="p-4 border-t border-slate-200">
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-slate-600">
                                显示 <span id="history-start">1</span> - <span id="history-end">20</span> 条，共 <span id="history-total">0</span> 条
                            </div>
                            <div class="flex items-center gap-2">
                                <button id="history-first-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">首页</button>
                                <button id="history-prev-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">上一页</button>
                                <span id="history-page-info" class="text-sm text-slate-600 px-3">第 1 页，共 1 页</span>
                                <button id="history-next-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">下一页</button>
                                <button id="history-last-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">末页</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Configuration Center Section -->
            <div id="config-section" class="hidden">
                <!-- 配置功能标签页 -->
                <div class="bg-white rounded-lg shadow-sm mb-6">
                    <div class="border-b border-slate-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <button class="config-tab-btn py-4 px-1 border-b-2 font-medium text-sm active" data-tab="factory">
                                工厂模型
                            </button>
                            <button class="config-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="tags">
                                标签管理
                            </button>
                            <button class="config-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="alarms">
                                报警参数
                            </button>
                            <button class="config-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="shifts">
                                班次配置
                            </button>
                            <button class="config-tab-btn py-4 px-1 border-b-2 font-medium text-sm" data-tab="statistics">
                                统计参数
                            </button>
                        </nav>
                    </div>

                    <!-- 工厂模型管理 -->
                    <div id="factory-tab" class="config-tab-content p-6">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">工厂模型管理</h3>
                            <p class="text-sm text-slate-600 mb-4">管理工厂--区域（装置）--单元--设备四级模型节点</p>

                            <!-- 操作工具栏 -->
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <button id="add-factory-node-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                        </svg>
                                        新增节点
                                    </button>
                                    <button id="import-factory-btn" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-green-700 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                                        </svg>
                                        导入
                                    </button>
                                    <button id="export-factory-btn" class="bg-amber-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-amber-700 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                        </svg>
                                        导出
                                    </button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <input type="text" id="factory-search" placeholder="搜索节点..." class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm w-48">
                                </div>
                            </div>

                            <!-- 工厂模型树形结构 -->
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <div id="factory-tree" class="space-y-2">
                                    <!-- 树形结构将通过JavaScript动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 标签管理 -->
                    <div id="tags-tab" class="config-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">标签管理</h3>
                            <p class="text-sm text-slate-600 mb-4">管理系统中的所有标签信息</p>

                            <!-- 操作工具栏 -->
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <button id="add-tag-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700 flex items-center gap-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                        </svg>
                                        新增标签
                                    </button>
                                    <button id="import-tags-btn" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-green-700">导入</button>
                                    <button id="export-tags-btn" class="bg-amber-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-amber-700">导出</button>
                                    <button id="batch-delete-tags-btn" class="bg-red-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-red-700">批量删除</button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <select id="tag-type-filter" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                        <option value="">全部类型</option>
                                        <option value="AI">模拟量输入</option>
                                        <option value="DI">数字量输入</option>
                                        <option value="AO">模拟量输出</option>
                                        <option value="DO">数字量输出</option>
                                    </select>
                                    <input type="text" id="tag-search" placeholder="搜索标签..." class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm w-48">
                                </div>
                            </div>

                            <!-- 标签列表 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">
                                                <input type="checkbox" id="select-all-tags" class="rounded">
                                            </th>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">量程上限</th>
                                            <th class="p-3">量程下限</th>
                                            <th class="p-3">计量单位</th>
                                            <th class="p-3">标签类型</th>
                                            <th class="p-3">所属区域</th>
                                            <th class="p-3">所属系统</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tags-list"></tbody>
                                </table>
                            </div>

                            <!-- 分页 -->
                            <div class="flex justify-between items-center mt-4">
                                <div class="text-sm text-slate-600">
                                    显示 <span id="tags-start">1</span> - <span id="tags-end">10</span> 条，共 <span id="tags-total">0</span> 条
                                </div>
                                <div class="flex items-center gap-2">
                                    <button id="tags-prev-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">上一页</button>
                                    <span id="tags-page-info" class="text-sm text-slate-600">第 1 页，共 1 页</span>
                                    <button id="tags-next-page" class="px-3 py-1 border border-slate-300 rounded text-sm hover:bg-slate-50">下一页</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 报警参数管理 -->
                    <div id="alarms-tab" class="config-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">报警参数管理</h3>
                            <p class="text-sm text-slate-600 mb-4">配置标签的报警阈值和处置时间参数</p>

                            <!-- 操作工具栏 -->
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center gap-2">
                                    <button id="add-alarm-param-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">新增参数</button>
                                    <button id="batch-config-btn" class="bg-purple-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-purple-700">批量配置</button>
                                    <button id="import-alarm-params-btn" class="bg-green-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-green-700">导入</button>
                                    <button id="export-alarm-params-btn" class="bg-amber-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-amber-700">导出</button>
                                </div>
                                <div class="flex items-center gap-2">
                                    <select id="alarm-level-filter" class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm">
                                        <option value="">全部等级</option>
                                        <option value="1">一级报警</option>
                                        <option value="2">二级报警</option>
                                        <option value="3">三级报警</option>
                                        <option value="4">四级报警</option>
                                    </select>
                                    <input type="text" id="alarm-param-search" placeholder="搜索标签..." class="bg-slate-100 border-slate-300 rounded-md p-2 text-sm w-48">
                                </div>
                            </div>

                            <!-- 报警参数列表 -->
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm text-left">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="p-3">标签位号</th>
                                            <th class="p-3">标签名称</th>
                                            <th class="p-3">高高限阈值</th>
                                            <th class="p-3">高限阈值</th>
                                            <th class="p-3">低限阈值</th>
                                            <th class="p-3">低低限阈值</th>
                                            <th class="p-3">报警等级</th>
                                            <th class="p-3">允许确认时间(s)</th>
                                            <th class="p-3">允许处置时间(s)</th>
                                            <th class="p-3">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="alarm-params-list"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 班次配置 -->
                    <div id="shifts-tab" class="config-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">班次配置</h3>
                            <p class="text-sm text-slate-600 mb-4">配置各厂班次的起止时间和工作日时间</p>

                            <!-- 班次时间配置 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">班次时间配置</h4>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">班次名称</label>
                                                <input type="text" value="早班" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">开始时间</label>
                                                <input type="time" value="08:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">结束时间</label>
                                                <input type="time" value="16:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-4">
                                            <div>
                                                <input type="text" value="中班" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <input type="time" value="16:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <input type="time" value="00:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-3 gap-4">
                                            <div>
                                                <input type="text" value="夜班" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <input type="time" value="00:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                            <div>
                                                <input type="time" value="08:00" class="w-full p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                        </div>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">保存班次配置</button>
                                    </div>
                                </div>

                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3">工作日配置</h4>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-7 gap-2 text-center">
                                            <div class="text-xs font-medium text-slate-600">周一</div>
                                            <div class="text-xs font-medium text-slate-600">周二</div>
                                            <div class="text-xs font-medium text-slate-600">周三</div>
                                            <div class="text-xs font-medium text-slate-600">周四</div>
                                            <div class="text-xs font-medium text-slate-600">周五</div>
                                            <div class="text-xs font-medium text-slate-600">周六</div>
                                            <div class="text-xs font-medium text-slate-600">周日</div>
                                        </div>
                                        <div class="grid grid-cols-7 gap-2">
                                            <input type="checkbox" checked class="rounded">
                                            <input type="checkbox" checked class="rounded">
                                            <input type="checkbox" checked class="rounded">
                                            <input type="checkbox" checked class="rounded">
                                            <input type="checkbox" checked class="rounded">
                                            <input type="checkbox" class="rounded">
                                            <input type="checkbox" class="rounded">
                                        </div>
                                        <div class="mt-4">
                                            <label class="block text-sm font-medium text-slate-700 mb-1">工作时间</label>
                                            <div class="grid grid-cols-2 gap-2">
                                                <input type="time" value="08:00" class="p-2 border border-slate-300 rounded-md text-sm">
                                                <input type="time" value="17:00" class="p-2 border border-slate-300 rounded-md text-sm">
                                            </div>
                                        </div>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700">保存工作日配置</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 班组配置 -->
                            <div class="bg-slate-50 p-4 rounded-lg">
                                <h4 class="font-semibold mb-3">班组配置</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm text-left">
                                        <thead class="bg-white">
                                            <tr>
                                                <th class="p-3">班组名称</th>
                                                <th class="p-3">班次</th>
                                                <th class="p-3">班长</th>
                                                <th class="p-3">成员数量</th>
                                                <th class="p-3">负责区域</th>
                                                <th class="p-3">联系方式</th>
                                                <th class="p-3">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody id="shifts-list">
                                            <tr class="border-b">
                                                <td class="p-3">甲班</td>
                                                <td class="p-3">早班</td>
                                                <td class="p-3">张三</td>
                                                <td class="p-3">8人</td>
                                                <td class="p-3">MTO装置</td>
                                                <td class="p-3">13800138001</td>
                                                <td class="p-3">
                                                    <button class="text-blue-600 hover:underline text-xs mr-2">编辑</button>
                                                    <button class="text-red-600 hover:underline text-xs">删除</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 统计参数配置 -->
                    <div id="statistics-tab" class="config-tab-content p-6 hidden">
                        <div class="mb-6">
                            <h3 class="text-lg font-bold mb-2">统计参数配置</h3>
                            <p class="text-sm text-slate-600 mb-4">配置系统统计分析的各项参数阈值</p>

                            <!-- 参数配置网格 -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- 滋扰报警参数 -->
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-amber-800">滋扰报警参数</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">间歇报警时间窗口</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="1" min="1" max="10" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">分钟</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">间歇报警数量阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="3" min="2" max="10" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">次</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">瞬闪报警时间间隔</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="3" min="1" max="10" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">秒</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">陈旧报警超时阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="24" min="1" max="72" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">小时</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 报警泛滥参数 -->
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-red-800">报警泛滥参数</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">泛滥统计时间窗口</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="10" min="5" max="30" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">分钟</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">泛滥开始数量阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="10" min="5" max="50" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">条</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">泛滥结束数量阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="5" min="1" max="20" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">条</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 性能评估参数 -->
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-blue-800">性能评估参数</h4>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">日报警率合格阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="144" min="50" max="500" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">条/天</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">10min峰值报警合格阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="10" min="5" max="30" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">条</span>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-slate-700 mb-1">TOP10报警占比合格阈值</label>
                                            <div class="flex items-center gap-2">
                                                <input type="number" value="5" min="1" max="20" step="0.1" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                <span class="text-sm text-slate-600">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 报警级别配置 -->
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-purple-800">报警级别占比</h4>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">一级报警占比</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" value="5" min="0" max="50" step="0.1" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                    <span class="text-sm text-slate-600">%</span>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">二级报警占比</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" value="15" min="0" max="50" step="0.1" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                    <span class="text-sm text-slate-600">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">三级报警占比</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" value="30" min="0" max="70" step="0.1" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                    <span class="text-sm text-slate-600">%</span>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">四级报警占比</label>
                                                <div class="flex items-center gap-2">
                                                    <input type="number" value="50" min="0" max="80" step="0.1" class="w-20 p-2 border border-slate-300 rounded-md text-sm">
                                                    <span class="text-sm text-slate-600">%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 分类配置 -->
                            <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-green-800">报警原因分类</h4>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">设备故障</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">参数异常</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">操作失误</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="text" placeholder="新增原因分类" class="flex-1 p-2 border border-slate-300 rounded-md text-sm">
                                            <button class="bg-green-600 text-white px-3 py-2 rounded-md text-sm hover:bg-green-700">添加</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-50 p-4 rounded-lg">
                                    <h4 class="font-semibold mb-3 text-indigo-800">处置措施分类</h4>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">设备维修</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">参数调整</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                                            <span class="text-sm">操作纠正</span>
                                            <button class="text-red-600 hover:underline text-xs">删除</button>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <input type="text" placeholder="新增措施分类" class="flex-1 p-2 border border-slate-300 rounded-md text-sm">
                                            <button class="bg-indigo-600 text-white px-3 py-2 rounded-md text-sm hover:bg-indigo-700">添加</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 保存按钮 -->
                            <div class="mt-6 text-center">
                                <button id="save-statistics-config-btn" class="bg-blue-600 text-white px-8 py-3 rounded-md font-semibold hover:bg-blue-700">
                                    保存所有配置
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </main>
        </div>
    </div>

    <!-- Action Modal -->
    <div id="action-modal" class="fixed inset-0 modal-backdrop flex justify-center items-center hidden z-30 p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full md:w-2/3 lg:w-1/2 max-w-2xl">
            <div class="p-6 border-b"><h3 class="text-xl font-bold">报警处置分析</h3></div>
            <div class="p-6 space-y-4">
                <div><label class="block text-sm font-medium text-slate-700">报警原因</label><textarea rows="3" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"></textarea></div>
                <div><label class="block text-sm font-medium text-slate-700">处置措施</label><textarea rows="3" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"></textarea></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium">分析人</label><input type="text" value="工程师A" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm sm:text-sm bg-slate-50" readonly></div>
                    <div><label class="block text-sm font-medium">处置人</label><input type="text" value="操作员B" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm sm:text-sm bg-slate-50" readonly></div>
                </div>
            </div>
            <div class="px-6 py-4 bg-slate-50 flex justify-end gap-3">
                <button type="button" class="modal-close-btn bg-white py-2 px-4 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50">取消</button>
                <button type="button" class="modal-save-btn bg-sky-600 text-white py-2 px-4 rounded-md shadow-sm text-sm font-medium hover:bg-sky-700">保存</button>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verify-modal" class="fixed inset-0 modal-backdrop flex justify-center items-center hidden z-30 p-4">
         <div class="bg-white rounded-lg shadow-2xl w-full md:w-2/3 lg:w-1/2 max-w-2xl">
            <div class="p-6 border-b"><h3 class="text-xl font-bold">验证关闭</h3></div>
            <div class="p-6 space-y-4">
                <div class="p-3 bg-slate-50 rounded-md border">
                    <p class="text-sm font-medium">报警原因:</p><p class="text-sm text-slate-600" id="verify-cause">仪表信号波动导致</p>
                    <p class="text-sm font-medium mt-2">处置措施:</p><p class="text-sm text-slate-600" id="verify-action">已通知仪表人员检查线路，并临时调整报警死区。</p>
                </div>
                <div><label class="block text-sm font-medium text-slate-700">验证意见</label><textarea rows="3" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500 sm:text-sm"></textarea></div>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium">验证人</label><input type="text" value="班长C" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm sm:text-sm bg-slate-50" readonly></div>
                </div>
            </div>
            <div class="px-6 py-4 bg-slate-50 flex justify-end gap-3">
                <button type="button" class="modal-close-btn bg-white py-2 px-4 border border-slate-300 rounded-md shadow-sm text-sm font-medium text-slate-700 hover:bg-slate-50">取消</button>
                <button type="button" class="modal-save-btn bg-green-600 text-white py-2 px-4 rounded-md shadow-sm text-sm font-medium hover:bg-green-700">验证关闭</button>
            </div>
        </div>
    </div>
    
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Mock Data Simulation ---
    const factoryModel = { 'all': { name: '全厂' }, 'MTO': { name: 'MTO装置', parent: 'all' }, 'R-2002': { name: 'R-2002单元', parent: 'MTO' }, 'C-2001': { name: 'C-2001单元', parent: 'MTO' } };
    const tagDatabase = { '80PIC11906': { unit: 'R-2002', description: 'R-2002反应器压力高报警' }, '41LIC20060': { unit: 'R-2002', description: 'R-2002反应器液位高高报警' }, '90TIC53008': { unit: 'C-2001', description: 'C-2001塔顶温度高报警' }, '10PI1001': { unit: 'C-2001', description: 'C-2001进料压力低报警' }};
    const alarmParameters = {
        '80PIC11906': { maxAckTime: 300, maxResTime: 1800 },
        '41LIC20060': { maxAckTime: 60, maxResTime: 300 },
        '90TIC53008': { maxAckTime: 300, maxResTime: 1800 },
        '10PI1001': { maxAckTime: 600, maxResTime: 3600 },
    };

    function generateMockAlarms(days) {
        const alarms = [];
        const now = new Date();
        const tags = Object.keys(tagDatabase);
        for (let i = 0; i < days * 250; i++) {
            const tag = tags[Math.floor(Math.random() * tags.length)];
            const alarmTime = new Date(now.getTime() - Math.random() * days * 24 * 60 * 60 * 1000);
            const ackTime = new Date(alarmTime.getTime() + (Math.random() * 10 * 60 * 1000));
            const recoveryTime = new Date(ackTime.getTime() + Math.random() * 60 * 60 * 1000);
            const statusRoll = Math.random();
            let status = '新报警';
            if (statusRoll > 0.7) status = '已处置';
            if (statusRoll > 0.9) status = '已关闭';
            
            alarms.push({
                id: i, time: alarmTime, tag: tag, priority: ['紧急', '重要', '一般'][Math.floor(Math.random() * 3)],
                unit: tagDatabase[tag].unit, nuisance: Math.random() < 0.15,
                description: tagDatabase[tag].description,
                ackTime: ackTime, recoveryTime: recoveryTime, status: status
            });
        }
        return alarms.sort((a, b) => b.time - a.time);
    }
    
    let fullAlarmLog = generateMockAlarms(60);
    let charts = {};
    let chartsInitialized = {
        monitoring: false,
        action: false,
        analysis: false,
        diagnostics: false,
        evaluation: false,
        reporting: false,
        config: false,
        history: false,
    };

    // 历史记录相关变量
    let historyRecords = [];
    let filteredHistoryRecords = [];
    let currentHistoryPage = 1;
    let historyPageSize = 20;

    // LLM服务相关变量
    let aiAssistantVisible = false;
    let chatHistory = [];
    let isAIProcessing = false;

    function safeInitChart(chartId, config) {
        try {
            if (charts[chartId]) {
                charts[chartId].destroy();
                delete charts[chartId];
            }
            const canvas = document.getElementById(chartId);
            if (!canvas) {
                console.error(`Canvas element with id ${chartId} not found`);
                return false;
            }
            if (!canvas.getContext) {
                console.error(`Canvas element ${chartId} does not support getContext`);
                return false;
            }
            charts[chartId] = new Chart(canvas.getContext('2d'), config);
            return true;
        } catch (error) {
            console.error(`Failed to create chart ${chartId}:`, error);
            return false;
        }
    }

    function initMonitoringCharts() {
        if (chartsInitialized.monitoring) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";

        // 趋势图配置 - 修复预测数据集配置
        const trendConfig = {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '报警数',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: '预测趋势',
                        data: [],
                        type: 'line',
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: '#f97316',
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    x: {
                        stacked: false
                    },
                    y: {
                        stacked: false,
                        beginAtZero: true
                    }
                }
            }
        };

        safeInitChart('trendChart', trendConfig);
        safeInitChart('priorityChart', {
            type: 'doughnut',
            data: {
                labels: ['紧急', '重要', '一般'],
                datasets: [{
                    data: [0, 0, 0],
                    backgroundColor: ['#ef4444', '#f97316', '#3b82f6']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
        safeInitChart('topAlarmsChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: '报警次数',
                    data: [],
                    backgroundColor: '#64748b'
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });
        safeInitChart('treemapChart', {
            type: 'treemap',
            data: {
                datasets: [{
                    tree: [],
                    key: 'value',
                    groups: ['unit'],
                    backgroundColor: (ctx) => ['#0ea5e9', '#14b8a6', '#f59e0b', '#8b5cf6'][ctx.dataIndex % 4],
                    labels: {
                        display: true,
                        color: 'white',
                        font: { size: 14, weight: 'bold' }
                    }
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                }
            }
        });
        chartsInitialized.monitoring = true;
    }

    function initActionCenterCharts() {
        if (chartsInitialized.action) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";
        safeInitChart('ackRateChart', { type: 'bar', data: { labels: [], datasets: [{ label: '及时确认率', data: [], backgroundColor: '#22c55e' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 60, max: 100, ticks: { callback: (value) => value + '%' } } } } });
        safeInitChart('resRateChart', { type: 'bar', data: { labels: [], datasets: [{ label: '及时处置率', data: [], backgroundColor: '#3b82f6' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { min: 60, max: 100, ticks: { callback: (value) => value + '%' } } } } });
        chartsInitialized.action = true;
    }

    function initAnalysisCenterCharts() {
        if (chartsInitialized.analysis) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";

        // 报警数量趋势图
        safeInitChart('alarmCountTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '报警数量',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: '#3b82f6',
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: '预测趋势',
                        data: [],
                        type: 'line',
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        pointRadius: 4,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 滋扰报警趋势图
        safeInitChart('nuisanceAlarmTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '滋扰报警数量',
                        data: [],
                        backgroundColor: 'rgba(245, 158, 11, 0.6)',
                        borderColor: '#f59e0b',
                        borderWidth: 1,
                        yAxisID: 'y'
                    },
                    {
                        label: '滋扰报警占比',
                        data: [],
                        type: 'line',
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // TOP10趋势图
        safeInitChart('top10TrendChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'TOP10报警数量',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        yAxisID: 'y'
                    },
                    {
                        label: 'TOP10占比',
                        data: [],
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // 10min峰值趋势图
        safeInitChart('peakTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '10min峰值',
                        data: [],
                        backgroundColor: 'rgba(239, 68, 68, 0.6)',
                        borderColor: '#ef4444',
                        borderWidth: 1,
                        order: 2
                    },
                    {
                        label: '预测峰值',
                        data: [],
                        type: 'line',
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        pointRadius: 4,
                        order: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 报警泛滥趋势图
        safeInitChart('floodTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '泛滥报警数量',
                        data: [],
                        backgroundColor: 'rgba(220, 38, 38, 0.6)',
                        borderColor: '#dc2626',
                        borderWidth: 1,
                        yAxisID: 'y'
                    },
                    {
                        label: '泛滥比例',
                        data: [],
                        type: 'line',
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 10,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // 报警确认趋势图
        safeInitChart('ackTrendChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '确认数量',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        yAxisID: 'y'
                    },
                    {
                        label: '及时确认率',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // 报警处置趋势图
        safeInitChart('resolveTrendChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '处置数量',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        yAxisID: 'y'
                    },
                    {
                        label: '及时处置率',
                        data: [],
                        borderColor: '#06b6d4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        // 处置时长趋势图
        safeInitChart('durationTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '平均确认时长(分钟)',
                        data: [],
                        backgroundColor: 'rgba(34, 197, 94, 0.6)',
                        borderColor: '#22c55e',
                        borderWidth: 1
                    },
                    {
                        label: '平均处置时长(分钟)',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => value + '分钟'
                        }
                    }
                }
            }
        });

        chartsInitialized.analysis = true;
    }

    function initDiagnosticsCenterCharts() {
        if (chartsInitialized.diagnostics) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";

        // 间歇报警图表
        safeInitChart('intermittentChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: '间歇报警次数',
                    data: [],
                    backgroundColor: 'rgba(245, 158, 11, 0.6)',
                    borderColor: '#f59e0b',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 瞬闪报警图表
        safeInitChart('flashChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: '瞬闪报警次数',
                    data: [],
                    backgroundColor: 'rgba(59, 130, 246, 0.6)',
                    borderColor: '#3b82f6',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 陈旧报警图表
        safeInitChart('staleChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '每日陈旧报警数量',
                    data: [],
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 滋扰报警趋势图
        safeInitChart('nuisanceTrendChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '滋扰报警数量',
                        data: [],
                        backgroundColor: 'rgba(245, 158, 11, 0.6)',
                        borderColor: '#f59e0b',
                        borderWidth: 1,
                        yAxisID: 'y'
                    },
                    {
                        label: '数量占比',
                        data: [],
                        type: 'line',
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: false,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' }
                },
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        },
                        grid: {
                            drawOnChartArea: false
                        }
                    }
                }
            }
        });

        chartsInitialized.diagnostics = true;
    }

    function initEvaluationCenterCharts() {
        if (chartsInitialized.evaluation) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";

        // 健康度雷达图
        safeInitChart('healthRadarChart', {
            type: 'radar',
            data: {
                labels: ['日报警率', '扰动率', '峰值', '泛滥比例', '滋扰比例', 'TOP10比例'],
                datasets: [
                    {
                        label: '当前装置',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderWidth: 2,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    },
                    {
                        label: '合格线',
                        data: [60, 60, 60, 60, 60, 60],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        pointBackgroundColor: '#ef4444',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
        });

        // 健康度排名图
        safeInitChart('healthRankingChart', {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: '综合健康度得分',
                    data: [],
                    backgroundColor: function(context) {
                        const value = context.parsed.y;
                        if (value >= 80) return '#059669';
                        if (value >= 70) return '#0891b2';
                        if (value >= 60) return '#d97706';
                        return '#dc2626';
                    },
                    borderColor: function(context) {
                        const value = context.parsed.y;
                        if (value >= 80) return '#047857';
                        if (value >= 70) return '#0e7490';
                        if (value >= 60) return '#b45309';
                        return '#b91c1c';
                    },
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    x: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '分'
                        }
                    }
                }
            }
        });

        // 成熟度雷达图
        safeInitChart('maturityRadarChart', {
            type: 'radar',
            data: {
                labels: ['性能指数', '下降率', '确认率', '处置率', '分析率'],
                datasets: [{
                    label: '管理成熟度',
                    data: [],
                    borderColor: '#059669',
                    backgroundColor: 'rgba(5, 150, 105, 0.2)',
                    borderWidth: 2,
                    pointBackgroundColor: '#059669',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
        });

        // 成熟度趋势图
        safeInitChart('maturityTrendChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '成熟度得分',
                    data: [],
                    borderColor: '#059669',
                    backgroundColor: 'rgba(5, 150, 105, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2,
                    pointBackgroundColor: '#059669',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '分'
                        }
                    }
                }
            }
        });

        // 审计问题分布图
        safeInitChart('auditIssueChart', {
            type: 'doughnut',
            data: {
                labels: ['阈值不一致', '优先级不一致', '未纳管', '配置错误'],
                datasets: [{
                    data: [],
                    backgroundColor: ['#ef4444', '#f97316', '#eab308', '#8b5cf6'],
                    borderColor: ['#dc2626', '#ea580c', '#ca8a04', '#7c3aed'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            }
        });

        chartsInitialized.evaluation = true;
    }

    function updateEvaluationCenterUI() {
        try {
            const { currentAlarms } = getFilteredData('evaluation-time-filter', 'evaluation-unit-filter');

            // 计算评估数据
            const evaluationData = calculateEvaluationData(currentAlarms);

            // 更新健康度评估
            updateHealthAssessment(evaluationData.health);

            // 更新成熟度分析
            updateMaturityAnalysis(evaluationData.maturity);

            // 更新参数审计
            updateParameterAudit(evaluationData.audit);

            // 更新总结建议
            updateEvaluationSummary(evaluationData);
        } catch (error) {
            console.error('评估中心更新错误:', error);
            // 显示简化版本
            showSimplifiedEvaluation();
        }
    }

    function showSimplifiedEvaluation() {
        // 显示简化的评估信息
        const healthListBody = document.getElementById('health-score-list');
        if (healthListBody) {
            healthListBody.innerHTML = `
                <tr class="border-b">
                    <td class="p-3">MTO装置</td>
                    <td class="p-3 text-lg font-bold text-blue-600">75.2分</td>
                    <td class="p-3">78</td>
                    <td class="p-3">72</td>
                    <td class="p-3">80</td>
                    <td class="p-3">70</td>
                    <td class="p-3">75</td>
                    <td class="p-3">73</td>
                    <td class="p-3"><span class="health-good">良好</span></td>
                </tr>
            `;
        }

        const maturityListBody = document.getElementById('maturity-score-list');
        if (maturityListBody) {
            maturityListBody.innerHTML = `
                <tr class="border-b">
                    <td class="p-3">MTO装置</td>
                    <td class="p-3 text-lg font-bold text-green-600">72.5分</td>
                    <td class="p-3">75</td>
                    <td class="p-3">70</td>
                    <td class="p-3">75</td>
                    <td class="p-3">68</td>
                    <td class="p-3">80</td>
                    <td class="p-3"><span class="health-good">较成熟</span></td>
                </tr>
            `;
        }
    }

    function calculateEvaluationData(alarms) {
        const units = ['MTO', 'R-2002', 'C-2001'];
        const healthData = {};
        const maturityData = {};

        // 简化的评估数据计算
        units.forEach((unit, index) => {
            const unitAlarms = alarms.filter(a => a.unit === unit);

            // 模拟健康度数据
            const baseScore = 70 + Math.random() * 20;
            const healthScores = {
                dailyAlarmRate: baseScore + Math.random() * 10,
                hourlyDisturbanceRate: baseScore + Math.random() * 10,
                peakValue: baseScore + Math.random() * 10,
                floodRatio: baseScore + Math.random() * 10,
                nuisanceRatio: baseScore + Math.random() * 10,
                top10Ratio: baseScore + Math.random() * 10
            };

            const overallHealth = Object.values(healthScores).reduce((sum, score) => sum + score, 0) / 6;

            healthData[unit] = {
                scores: healthScores,
                overall: overallHealth,
                level: getHealthLevel(overallHealth)
            };

            // 模拟成熟度数据
            const maturityScores = {
                performanceIndex: overallHealth * 0.25,
                alarmDeclineRate: (60 + Math.random() * 20) * 0.25,
                timelyAckRate: (70 + Math.random() * 20) * 0.2,
                timelyResolveRate: (65 + Math.random() * 20) * 0.2,
                analysisRate: (80 + Math.random() * 15) * 0.1
            };

            const overallMaturity = Object.values(maturityScores).reduce((sum, score) => sum + score, 0);

            maturityData[unit] = {
                scores: maturityScores,
                overall: overallMaturity,
                level: getMaturityLevel(overallMaturity)
            };
        });

        // 参数审计数据
        const auditData = generateAuditData();

        return { health: healthData, maturity: maturityData, audit: auditData };
    }

    function calculateDisturbanceRate(alarms) {
        // 简化计算：基于报警频率
        return Math.min(50, alarms.length / 100);
    }

    function calculatePeakValue(alarms) {
        // 计算10分钟内最大报警数
        let maxPeak = 0;
        for (let i = 0; i < alarms.length; i++) {
            let count = 1;
            for (let j = i + 1; j < alarms.length; j++) {
                if ((alarms[j].time - alarms[i].time) < 600000) count++;
                else break;
            }
            if (count > maxPeak) maxPeak = count;
        }
        return maxPeak;
    }

    function calculateFloodRatio(alarms) {
        const floodAlarms = alarms.filter((_, idx) => {
            let count = 1;
            for (let i = idx + 1; i < alarms.length; i++) {
                if ((alarms[i].time - alarms[idx].time) < 600000) count++;
                else break;
            }
            return count > 10;
        });
        return alarms.length > 0 ? (floodAlarms.length / alarms.length * 100) : 0;
    }

    function calculateNuisanceRatio(alarms) {
        const nuisanceAlarms = alarms.filter(a => a.nuisance);
        return alarms.length > 0 ? (nuisanceAlarms.length / alarms.length * 100) : 0;
    }

    function calculateTop10Ratio(alarms) {
        const tagCounts = {};
        alarms.forEach(a => tagCounts[a.tag] = (tagCounts[a.tag] || 0) + 1);
        const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
        const top10Count = sortedTags.slice(0, 10).reduce((sum, [, count]) => sum + count, 0);
        return alarms.length > 0 ? (top10Count / alarms.length * 100) : 0;
    }

    function calculateDeclineRate(alarms) {
        // 简化计算：假设环比下降5%
        return -5;
    }

    function calculateTimelyAckRate(alarms) {
        const ackedAlarms = alarms.filter(a => a.ackTime);
        const timelyAcked = ackedAlarms.filter(a => {
            const params = alarmParameters[a.tag];
            return params && (a.ackTime - a.time) / 1000 <= params.maxAckTime;
        });
        return ackedAlarms.length > 0 ? (timelyAcked.length / ackedAlarms.length * 100) : 0;
    }

    function calculateTimelyResolveRate(alarms) {
        const resolvedAlarms = alarms.filter(a => a.recoveryTime);
        const timelyResolved = resolvedAlarms.filter(a => {
            const params = alarmParameters[a.tag];
            return params && (a.recoveryTime - a.time) / 1000 <= params.maxResTime;
        });
        return resolvedAlarms.length > 0 ? (timelyResolved.length / resolvedAlarms.length * 100) : 0;
    }

    function calculateAnalysisRate(alarms) {
        // 假设80%的报警已完成分析
        return 80;
    }

    function getHealthLevel(score) {
        if (score >= 80) return { text: '优秀', class: 'health-excellent' };
        if (score >= 70) return { text: '良好', class: 'health-good' };
        if (score >= 60) return { text: '合格', class: 'health-fair' };
        return { text: '需改进', class: 'health-poor' };
    }

    function getMaturityLevel(score) {
        if (score >= 80) return { text: '成熟', class: 'health-excellent' };
        if (score >= 70) return { text: '较成熟', class: 'health-good' };
        if (score >= 60) return { text: '基本成熟', class: 'health-fair' };
        return { text: '不成熟', class: 'health-poor' };
    }

    function updateHealthAssessment(healthData) {
        // 更新雷达图
        const selectedUnit = document.getElementById('radar-unit-select')?.value || 'MTO';
        if (charts.healthRadarChart && healthData[selectedUnit]) {
            const scores = healthData[selectedUnit].scores;
            charts.healthRadarChart.data.datasets[0].data = [
                scores.dailyAlarmRate,
                scores.hourlyDisturbanceRate,
                scores.peakValue,
                scores.floodRatio,
                scores.nuisanceRatio,
                scores.top10Ratio
            ];
            charts.healthRadarChart.update('none');
        }

        // 更新排名图
        if (charts.healthRankingChart) {
            const units = Object.keys(healthData);
            const sortedUnits = units.sort((a, b) => healthData[b].overall - healthData[a].overall);
            charts.healthRankingChart.data.labels = sortedUnits;
            charts.healthRankingChart.data.datasets[0].data = sortedUnits.map(unit => healthData[unit].overall);
            charts.healthRankingChart.update('none');
        }

        // 更新健康度评分表
        const listBody = document.getElementById('health-score-list');
        if (listBody) {
            listBody.innerHTML = Object.entries(healthData).map(([unit, data]) => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-semibold">${unit}</td>
                    <td class="p-3 text-lg font-bold text-blue-600">${data.overall.toFixed(1)}分</td>
                    <td class="p-3">${data.scores.dailyAlarmRate.toFixed(1)}</td>
                    <td class="p-3">${data.scores.hourlyDisturbanceRate.toFixed(1)}</td>
                    <td class="p-3">${data.scores.peakValue.toFixed(1)}</td>
                    <td class="p-3">${data.scores.floodRatio.toFixed(1)}</td>
                    <td class="p-3">${data.scores.nuisanceRatio.toFixed(1)}</td>
                    <td class="p-3">${data.scores.top10Ratio.toFixed(1)}</td>
                    <td class="p-3">
                        <span class="${data.level.class}">${data.level.text}</span>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateMaturityAnalysis(maturityData) {
        // 更新成熟度雷达图 - 显示全厂平均
        if (charts.maturityRadarChart) {
            const units = Object.keys(maturityData);
            const avgScores = {
                performanceIndex: 0,
                alarmDeclineRate: 0,
                timelyAckRate: 0,
                timelyResolveRate: 0,
                analysisRate: 0
            };

            units.forEach(unit => {
                Object.keys(avgScores).forEach(key => {
                    avgScores[key] += maturityData[unit].scores[key];
                });
            });

            Object.keys(avgScores).forEach(key => {
                avgScores[key] = avgScores[key] / units.length;
            });

            charts.maturityRadarChart.data.datasets[0].data = Object.values(avgScores);
            charts.maturityRadarChart.update('none');
        }

        // 更新成熟度趋势图
        if (charts.maturityTrendChart) {
            const labels = ['第1周', '第2周', '第3周', '第4周'];
            const trendData = [65, 68, 72, 75]; // 模拟趋势数据
            charts.maturityTrendChart.data.labels = labels;
            charts.maturityTrendChart.data.datasets[0].data = trendData;
            charts.maturityTrendChart.update('none');
        }

        // 更新成熟度评分表
        const listBody = document.getElementById('maturity-score-list');
        if (listBody) {
            listBody.innerHTML = Object.entries(maturityData).map(([unit, data]) => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-semibold">${unit}</td>
                    <td class="p-3 text-lg font-bold text-green-600">${data.overall.toFixed(1)}分</td>
                    <td class="p-3">${data.scores.performanceIndex.toFixed(1)}</td>
                    <td class="p-3">${data.scores.alarmDeclineRate.toFixed(1)}</td>
                    <td class="p-3">${data.scores.timelyAckRate.toFixed(1)}</td>
                    <td class="p-3">${data.scores.timelyResolveRate.toFixed(1)}</td>
                    <td class="p-3">${data.scores.analysisRate.toFixed(1)}</td>
                    <td class="p-3">
                        <span class="${data.level.class}">${data.level.text}</span>
                    </td>
                </tr>
            `).join('');
        }
    }

    function generateAuditData() {
        // 模拟审计数据
        const auditResults = [
            {
                tag: '80PIC11906',
                name: 'R-2002反应器压力高报警',
                issue: '阈值不一致',
                recordValue: '2.5 MPa',
                configValue: '2.8 MPa',
                riskLevel: 'high',
                riskDesc: '可能导致误报或漏报',
                suggestion: '建议统一阈值设置'
            },
            {
                tag: '80TIC11907',
                name: 'R-2002反应器温度高报警',
                issue: '优先级不一致',
                recordValue: '重要',
                configValue: '紧急',
                riskLevel: 'medium',
                riskDesc: '影响报警响应优先级',
                suggestion: '建议调整优先级配置'
            },
            {
                tag: '80LIC11908',
                name: 'C-2001分离器液位低报警',
                issue: '未纳管',
                recordValue: '无配置',
                configValue: '应配置',
                riskLevel: 'high',
                riskDesc: '重要报警未纳入管理',
                suggestion: '建议立即纳入管理'
            }
        ];

        const issueStats = {
            threshold: auditResults.filter(r => r.issue === '阈值不一致').length,
            priority: auditResults.filter(r => r.issue === '优先级不一致').length,
            unmanaged: auditResults.filter(r => r.issue === '未纳管').length,
            config: auditResults.filter(r => r.issue === '配置错误').length
        };

        return {
            results: auditResults,
            stats: issueStats,
            total: auditResults.length,
            highRisk: auditResults.filter(r => r.riskLevel === 'high').length
        };
    }

    function updateParameterAudit(auditData) {
        // 更新统计卡片
        document.getElementById('audit-total-count').textContent = 150; // 假设总数
        document.getElementById('audit-issue-count').textContent = auditData.total;
        document.getElementById('audit-high-risk-count').textContent = auditData.highRisk;
        document.getElementById('audit-compliance-rate').textContent =
            `${((150 - auditData.total) / 150 * 100).toFixed(1)}%`;

        // 更新问题分布图
        if (charts.auditIssueChart) {
            charts.auditIssueChart.data.datasets[0].data = [
                auditData.stats.threshold,
                auditData.stats.priority,
                auditData.stats.unmanaged,
                auditData.stats.config
            ];
            charts.auditIssueChart.update('none');
        }

        // 更新审计结果列表
        const listBody = document.getElementById('audit-result-list');
        if (listBody) {
            listBody.innerHTML = auditData.results.map(item => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-mono">${item.tag}</td>
                    <td class="p-3">${item.name}</td>
                    <td class="p-3">${item.issue}</td>
                    <td class="p-3">${item.recordValue}</td>
                    <td class="p-3">${item.configValue}</td>
                    <td class="p-3">
                        <span class="px-2 py-1 rounded text-xs risk-${item.riskLevel}">
                            ${item.riskLevel === 'high' ? '高风险' : item.riskLevel === 'medium' ? '中风险' : '低风险'}
                        </span>
                    </td>
                    <td class="p-3 text-sm">${item.riskDesc}</td>
                    <td class="p-3 text-sm">${item.suggestion}</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline text-xs" onclick="fixAuditIssue('${item.tag}')">修复</button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateEvaluationSummary(evaluationData) {
        // 健康度总结
        const avgHealth = Object.values(evaluationData.health).reduce((sum, data) => sum + data.overall, 0) /
                         Object.keys(evaluationData.health).length;
        document.getElementById('health-summary').innerHTML = `
            <p>• 整体健康度得分: ${avgHealth.toFixed(1)}分</p>
            <p>• 主要问题: 滋扰报警比例偏高</p>
            <p>• 改进建议: 优先处理间歇报警</p>
        `;

        // 成熟度总结
        const avgMaturity = Object.values(evaluationData.maturity).reduce((sum, data) => sum + data.overall, 0) /
                           Object.keys(evaluationData.maturity).length;
        document.getElementById('maturity-summary').innerHTML = `
            <p>• 管理成熟度得分: ${avgMaturity.toFixed(1)}分</p>
            <p>• 管理短板: 处置分析率有待提升</p>
            <p>• 能力建议: 加强人员培训</p>
        `;

        // 审计总结
        document.getElementById('audit-summary').innerHTML = `
            <p>• 参数一致性: ${((150 - evaluationData.audit.total) / 150 * 100).toFixed(1)}%</p>
            <p>• 高风险问题: ${evaluationData.audit.highRisk}项</p>
            <p>• 整改建议: 优先处理未纳管报警</p>
        `;
    }

    // 辅助函数
    function fixAuditIssue(tag) {
        alert(`修复标签 ${tag} 的参数问题`);
    }

    function initReportingCenterCharts() {
        if (chartsInitialized.reporting) return;
        Chart.defaults.font.family = "'Noto Sans SC', sans-serif";

        // 报警数量趋势图
        safeInitChart('reportAlarmTrendChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: '报警数量',
                    data: [],
                    borderColor: '#3b82f6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 2,
                    pointBackgroundColor: '#3b82f6',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => value + '条'
                        }
                    }
                }
            }
        });

        // 处置效率趋势图
        safeInitChart('reportEfficiencyChart', {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: '及时确认率',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        borderWidth: 2
                    },
                    {
                        label: '及时处置率',
                        data: [],
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        tension: 0.4,
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: (value) => value + '%'
                        }
                    }
                }
            }
        });

        // 问题分布饼图
        safeInitChart('reportProblemChart', {
            type: 'doughnut',
            data: {
                labels: ['设备老化', '参数设置', '操作规程', '其他'],
                datasets: [{
                    data: [],
                    backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#8b5cf6'],
                    borderColor: ['#dc2626', '#d97706', '#2563eb', '#7c3aed'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            }
        });

        chartsInitialized.reporting = true;
    }

    function updateReportingCenterUI() {
        try {
            // 获取报告参数
            const reportType = document.getElementById('report-type')?.value || 'monthly';
            const startDate = document.getElementById('report-start-date')?.value || '2024-01-01';
            const endDate = document.getElementById('report-end-date')?.value || '2024-01-31';
            const scope = document.getElementById('report-scope')?.value || 'all';

            // 生成报告数据
            const reportData = generateReportData(reportType, startDate, endDate, scope);

            // 更新报告内容
            updateReportContent(reportData);

            // 更新图表
            updateReportCharts(reportData);

        } catch (error) {
            console.error('报告中心更新错误:', error);
            showDefaultReport();
        }
    }

    function generateReportData(reportType, startDate, endDate, scope) {
        // 模拟报告数据生成
        const reportData = {
            title: getReportTitle(reportType, startDate, endDate, scope),
            subtitle: getReportSubtitle(startDate, endDate, scope),
            generateTime: new Date().toLocaleString('zh-CN'),
            reportNumber: generateReportNumber(),

            // 核心指标
            kpis: {
                totalAlarms: 1245,
                nuisanceRate: 15.2,
                ackRate: 92.1,
                resolveRate: 87.6,
                healthScore: 75.3
            },

            // 趋势数据
            trends: {
                alarmTrend: generateAlarmTrendData(),
                efficiencyTrend: generateEfficiencyTrendData()
            },

            // 问题分析
            problems: {
                distribution: [35, 25, 30, 10], // 设备老化、参数设置、操作规程、其他
                highFrequency: [
                    { tag: '80PIC11906', description: 'R-2002反应器压力高报警', count: 156 },
                    { tag: '80TIC11907', description: 'R-2002反应器温度高报警', count: 134 },
                    { tag: '80LIC11908', description: 'C-2001分离器液位低报警', count: 98 }
                ]
            }
        };

        return reportData;
    }

    function getReportTitle(reportType, startDate, endDate, scope) {
        const typeMap = {
            'weekly': '周度',
            'monthly': '月度',
            'quarterly': '季度',
            'custom': '专项'
        };

        const scopeMap = {
            'all': '全厂',
            'MTO': 'MTO装置',
            'R-2002': 'R-2002单元',
            'C-2001': 'C-2001单元'
        };

        return `报警管理${typeMap[reportType]}分析报告`;
    }

    function getReportSubtitle(startDate, endDate, scope) {
        const scopeMap = {
            'all': '全厂',
            'MTO': 'MTO装置',
            'R-2002': 'R-2002单元',
            'C-2001': 'C-2001单元'
        };

        const start = new Date(startDate);
        const end = new Date(endDate);

        return `${start.getFullYear()}年${start.getMonth()+1}月${start.getDate()}日 - ${end.getMonth()+1}月${end.getDate()}日 ${scopeMap[scope]}报警系统运行分析`;
    }

    function generateReportNumber() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const random = String(Math.floor(Math.random() * 1000)).padStart(3, '0');
        return `RPT-${year}${month}${day}-${random}`;
    }

    function generateAlarmTrendData() {
        const labels = [];
        const data = [];

        for (let i = 0; i < 30; i++) {
            const date = new Date();
            date.setDate(date.getDate() - 29 + i);
            labels.push(`${date.getMonth()+1}/${date.getDate()}`);
            data.push(Math.floor(Math.random() * 50) + 20);
        }

        return { labels, data };
    }

    function generateEfficiencyTrendData() {
        const labels = [];
        const ackData = [];
        const resolveData = [];

        for (let i = 0; i < 30; i++) {
            const date = new Date();
            date.setDate(date.getDate() - 29 + i);
            labels.push(`${date.getMonth()+1}/${date.getDate()}`);
            ackData.push(Math.floor(Math.random() * 20) + 80);
            resolveData.push(Math.floor(Math.random() * 25) + 70);
        }

        return { labels, ackData, resolveData };
    }

    function updateReportContent(reportData) {
        // 更新报告标题和基本信息
        document.getElementById('report-title').textContent = reportData.title;
        document.getElementById('report-subtitle').textContent = reportData.subtitle;
        document.getElementById('report-generate-time').textContent = reportData.generateTime;
        document.getElementById('report-number').textContent = reportData.reportNumber;

        // 更新执行摘要
        document.getElementById('summary-total-alarms').textContent = reportData.kpis.totalAlarms.toLocaleString();
        document.getElementById('summary-nuisance-ratio').textContent = reportData.kpis.nuisanceRate + '%';
        document.getElementById('summary-ack-rate').textContent = reportData.kpis.ackRate + '%';
        document.getElementById('summary-resolve-rate').textContent = reportData.kpis.resolveRate + '%';
        document.getElementById('summary-health-score').textContent = reportData.kpis.healthScore;

        // 更新KPI卡片
        document.getElementById('kpi-total-alarms').textContent = reportData.kpis.totalAlarms.toLocaleString();
        document.getElementById('kpi-nuisance-rate').textContent = reportData.kpis.nuisanceRate + '%';
        document.getElementById('kpi-ack-rate').textContent = reportData.kpis.ackRate + '%';
        document.getElementById('kpi-health-score').textContent = reportData.kpis.healthScore;

        // 更新高频报警问题
        const highFrequencyIssues = document.getElementById('high-frequency-issues');
        if (highFrequencyIssues && reportData.problems.highFrequency) {
            const issuesList = reportData.problems.highFrequency.map(item =>
                `<li><strong>${item.tag}</strong> - ${item.description}，报警次数: ${item.count}次</li>`
            ).join('');

            highFrequencyIssues.innerHTML = `
                <p class="mb-2">发现以下标签存在高频报警问题：</p>
                <ul class="list-disc list-inside space-y-1">${issuesList}</ul>
            `;
        }
    }

    function updateReportCharts(reportData) {
        // 更新报警趋势图
        if (charts.reportAlarmTrendChart && reportData.trends.alarmTrend) {
            charts.reportAlarmTrendChart.data.labels = reportData.trends.alarmTrend.labels;
            charts.reportAlarmTrendChart.data.datasets[0].data = reportData.trends.alarmTrend.data;
            charts.reportAlarmTrendChart.update('none');
        }

        // 更新效率趋势图
        if (charts.reportEfficiencyChart && reportData.trends.efficiencyTrend) {
            charts.reportEfficiencyChart.data.labels = reportData.trends.efficiencyTrend.labels;
            charts.reportEfficiencyChart.data.datasets[0].data = reportData.trends.efficiencyTrend.ackData;
            charts.reportEfficiencyChart.data.datasets[1].data = reportData.trends.efficiencyTrend.resolveData;
            charts.reportEfficiencyChart.update('none');
        }

        // 更新问题分布图
        if (charts.reportProblemChart && reportData.problems.distribution) {
            charts.reportProblemChart.data.datasets[0].data = reportData.problems.distribution;
            charts.reportProblemChart.update('none');
        }
    }

    function showDefaultReport() {
        // 显示默认报告内容
        document.getElementById('report-title').textContent = '报警管理月度分析报告';
        document.getElementById('report-subtitle').textContent = '2024年1月 - 全厂报警系统运行分析';
        document.getElementById('report-generate-time').textContent = new Date().toLocaleString('zh-CN');
        document.getElementById('report-number').textContent = 'RPT-2024-001';

        // 设置默认KPI值
        document.getElementById('summary-total-alarms').textContent = '1,245';
        document.getElementById('summary-nuisance-ratio').textContent = '15.2%';
        document.getElementById('summary-ack-rate').textContent = '92.1%';
        document.getElementById('summary-resolve-rate').textContent = '87.6%';
        document.getElementById('summary-health-score').textContent = '75.3';

        document.getElementById('kpi-total-alarms').textContent = '1,245';
        document.getElementById('kpi-nuisance-rate').textContent = '15.2%';
        document.getElementById('kpi-ack-rate').textContent = '92.1%';
        document.getElementById('kpi-health-score').textContent = '75.3';
    }

    function generateReport() {
        // 显示生成中状态
        const generateBtn = document.getElementById('generate-report-btn');
        const originalText = generateBtn.innerHTML;
        generateBtn.innerHTML = `
            <svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            生成中...
        `;
        generateBtn.disabled = true;

        // 模拟生成过程
        setTimeout(() => {
            updateReportingCenterUI();
            generateBtn.innerHTML = originalText;
            generateBtn.disabled = false;

            // 显示成功消息
            showNotification('报告生成成功！', 'success');
        }, 2000);
    }

    function exportReport() {
        // 模拟导出功能
        showNotification('报告导出功能开发中...', 'info');
    }

    function showNotification(message, type = 'info') {
        // 简单的通知显示
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
            type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
            type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
            'bg-blue-100 text-blue-800 border border-blue-200'
        }`;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function initConfigurationCenter() {
        if (chartsInitialized.config) return;

        // 初始化工厂模型树
        initFactoryTree();

        // 初始化标签列表
        initTagsList();

        // 初始化报警参数列表
        initAlarmParamsList();

        chartsInitialized.config = true;
    }

    function updateConfigurationCenterUI() {
        try {
            // 更新各个配置模块
            updateFactoryTree();
            updateTagsList();
            updateAlarmParamsList();
        } catch (error) {
            console.error('基础配置更新错误:', error);
        }
    }

    function initFactoryTree() {
        const factoryTreeContainer = document.getElementById('factory-tree');
        if (!factoryTreeContainer) return;

        const factoryStructure = [
            {
                id: 'factory-001',
                name: '石化工厂',
                type: 'factory',
                level: 0,
                children: [
                    {
                        id: 'area-mto',
                        name: 'MTO装置',
                        type: 'area',
                        level: 1,
                        children: [
                            {
                                id: 'unit-r2002',
                                name: 'R-2002反应单元',
                                type: 'unit',
                                level: 2,
                                children: [
                                    { id: 'device-r2002-01', name: 'R-2002反应器', type: 'device', level: 3 },
                                    { id: 'device-r2002-02', name: 'R-2002换热器', type: 'device', level: 3 }
                                ]
                            },
                            {
                                id: 'unit-c2001',
                                name: 'C-2001分离单元',
                                type: 'unit',
                                level: 2,
                                children: [
                                    { id: 'device-c2001-01', name: 'C-2001分离器', type: 'device', level: 3 },
                                    { id: 'device-c2001-02', name: 'C-2001冷凝器', type: 'device', level: 3 }
                                ]
                            }
                        ]
                    }
                ]
            }
        ];

        factoryTreeContainer.innerHTML = generateTreeHTML(factoryStructure);
    }

    function generateTreeHTML(nodes) {
        return nodes.map(node => {
            const hasChildren = node.children && node.children.length > 0;
            const childrenHTML = hasChildren ? generateTreeHTML(node.children) : '';

            return `
                <div class="factory-node level-${node.level}" data-id="${node.id}" data-type="${node.type}">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            ${hasChildren ?
                                '<svg class="w-4 h-4 text-slate-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>' :
                                '<svg class="w-4 h-4 text-slate-300" fill="currentColor" viewBox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
                            }
                            <span class="text-sm">${node.name}</span>
                            <span class="text-xs text-slate-500 bg-slate-200 px-2 py-1 rounded">${node.type}</span>
                        </div>
                        <div class="flex items-center gap-1">
                            <button class="text-blue-600 hover:underline text-xs" onclick="editFactoryNode('${node.id}')">编辑</button>
                            <button class="text-red-600 hover:underline text-xs" onclick="deleteFactoryNode('${node.id}')">删除</button>
                        </div>
                    </div>
                    ${childrenHTML}
                </div>
            `;
        }).join('');
    }

    function updateFactoryTree() {
        // 工厂模型树已在初始化时生成，这里可以添加动态更新逻辑
    }

    function initTagsList() {
        const tagsData = [
            {
                id: 'tag-001',
                tagNo: '80PIC11906',
                tagName: 'R-2002反应器压力',
                rangeHigh: 3.0,
                rangeLow: 0.0,
                unit: 'MPa',
                type: 'AI',
                area: 'MTO装置',
                system: 'DCS'
            },
            {
                id: 'tag-002',
                tagNo: '80TIC11907',
                tagName: 'R-2002反应器温度',
                rangeHigh: 500.0,
                rangeLow: 0.0,
                unit: '℃',
                type: 'AI',
                area: 'MTO装置',
                system: 'DCS'
            },
            {
                id: 'tag-003',
                tagNo: '80LIC11908',
                tagName: 'C-2001分离器液位',
                rangeHigh: 100.0,
                rangeLow: 0.0,
                unit: '%',
                type: 'AI',
                area: 'MTO装置',
                system: 'DCS'
            }
        ];

        updateTagsTable(tagsData);
    }

    function updateTagsList() {
        // 标签列表更新逻辑
        initTagsList();
    }

    function updateTagsTable(tagsData) {
        const tableBody = document.getElementById('tags-list');
        if (!tableBody) return;

        tableBody.innerHTML = tagsData.map(tag => `
            <tr class="border-b hover:bg-slate-50">
                <td class="p-3">
                    <input type="checkbox" class="rounded tag-checkbox" data-id="${tag.id}">
                </td>
                <td class="p-3 font-mono">${tag.tagNo}</td>
                <td class="p-3">${tag.tagName}</td>
                <td class="p-3">${tag.rangeHigh}</td>
                <td class="p-3">${tag.rangeLow}</td>
                <td class="p-3">${tag.unit}</td>
                <td class="p-3">
                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">${tag.type}</span>
                </td>
                <td class="p-3">${tag.area}</td>
                <td class="p-3">${tag.system}</td>
                <td class="p-3">
                    <button class="text-blue-600 hover:underline text-xs mr-2" onclick="editTag('${tag.id}')">编辑</button>
                    <button class="text-red-600 hover:underline text-xs" onclick="deleteTag('${tag.id}')">删除</button>
                </td>
            </tr>
        `).join('');

        // 更新分页信息
        document.getElementById('tags-total').textContent = tagsData.length;
        document.getElementById('tags-end').textContent = Math.min(10, tagsData.length);
    }

    function initAlarmParamsList() {
        const alarmParamsData = [
            {
                id: 'alarm-001',
                tagNo: '80PIC11906',
                tagName: 'R-2002反应器压力',
                highHighLimit: 2.8,
                highLimit: 2.5,
                lowLimit: 0.5,
                lowLowLimit: 0.2,
                alarmLevel: 2,
                maxAckTime: 300,
                maxResTime: 1800
            },
            {
                id: 'alarm-002',
                tagNo: '80TIC11907',
                tagName: 'R-2002反应器温度',
                highHighLimit: 450,
                highLimit: 420,
                lowLimit: 50,
                lowLowLimit: 20,
                alarmLevel: 1,
                maxAckTime: 180,
                maxResTime: 900
            },
            {
                id: 'alarm-003',
                tagNo: '80LIC11908',
                tagName: 'C-2001分离器液位',
                highHighLimit: 95,
                highLimit: 90,
                lowLimit: 10,
                lowLowLimit: 5,
                alarmLevel: 3,
                maxAckTime: 600,
                maxResTime: 3600
            }
        ];

        updateAlarmParamsTable(alarmParamsData);
    }

    function updateAlarmParamsList() {
        // 报警参数列表更新逻辑
        initAlarmParamsList();
    }

    function updateAlarmParamsTable(alarmParamsData) {
        const tableBody = document.getElementById('alarm-params-list');
        if (!tableBody) return;

        const levelColors = {
            1: 'bg-red-100 text-red-800',
            2: 'bg-orange-100 text-orange-800',
            3: 'bg-yellow-100 text-yellow-800',
            4: 'bg-blue-100 text-blue-800'
        };

        tableBody.innerHTML = alarmParamsData.map(param => `
            <tr class="border-b hover:bg-slate-50">
                <td class="p-3 font-mono">${param.tagNo}</td>
                <td class="p-3">${param.tagName}</td>
                <td class="p-3">${param.highHighLimit || '-'}</td>
                <td class="p-3">${param.highLimit || '-'}</td>
                <td class="p-3">${param.lowLimit || '-'}</td>
                <td class="p-3">${param.lowLowLimit || '-'}</td>
                <td class="p-3">
                    <span class="px-2 py-1 rounded text-xs ${levelColors[param.alarmLevel] || 'bg-gray-100 text-gray-800'}">
                        ${param.alarmLevel}级
                    </span>
                </td>
                <td class="p-3">${param.maxAckTime}</td>
                <td class="p-3">${param.maxResTime}</td>
                <td class="p-3">
                    <button class="text-blue-600 hover:underline text-xs mr-2" onclick="editAlarmParam('${param.id}')">编辑</button>
                    <button class="text-red-600 hover:underline text-xs" onclick="deleteAlarmParam('${param.id}')">删除</button>
                </td>
            </tr>
        `).join('');
    }

    // 事件处理函数
    function editFactoryNode(nodeId) {
        showNotification(`编辑工厂节点: ${nodeId}`, 'info');
    }

    function deleteFactoryNode(nodeId) {
        if (confirm('确定要删除这个节点吗？')) {
            showNotification(`删除工厂节点: ${nodeId}`, 'success');
        }
    }

    function editTag(tagId) {
        showNotification(`编辑标签: ${tagId}`, 'info');
    }

    function deleteTag(tagId) {
        if (confirm('确定要删除这个标签吗？')) {
            showNotification(`删除标签: ${tagId}`, 'success');
        }
    }

    function editAlarmParam(paramId) {
        showNotification(`编辑报警参数: ${paramId}`, 'info');
    }

    function deleteAlarmParam(paramId) {
        if (confirm('确定要删除这个报警参数吗？')) {
            showNotification(`删除报警参数: ${paramId}`, 'success');
        }
    }

    function importData(type) {
        showNotification(`${type}数据导入功能开发中...`, 'info');
    }

    function exportData(type) {
        showNotification(`${type}数据导出功能开发中...`, 'info');
    }

    function saveConfiguration() {
        // 显示保存中状态
        const saveBtn = document.getElementById('save-statistics-config-btn');
        if (saveBtn) {
            const originalText = saveBtn.textContent;
            saveBtn.textContent = '保存中...';
            saveBtn.disabled = true;

            setTimeout(() => {
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
                showNotification('配置保存成功！', 'success');
            }, 1500);
        }
    }

    function updateDiagnosticsCenterUI() {
        const { currentAlarms } = getFilteredData('diagnostics-time-filter', 'diagnostics-unit-filter');

        // 分析滋扰报警
        const diagnosticsData = analyzeDiagnosticsData(currentAlarms);

        // 更新各个标签页的内容
        updateIntermittentAnalysis(diagnosticsData.intermittent);
        updateFlashAnalysis(diagnosticsData.flash);
        updateStaleAnalysis(diagnosticsData.stale);
        updateNuisanceAnalysis(diagnosticsData.nuisance);
        updateTopAnalysis(diagnosticsData.top);
        updateShelveManagement();
    }

    function analyzeDiagnosticsData(alarms) {
        const now = new Date();
        const intermittentThreshold = 3; // 每分钟3次以上
        const flashThreshold = 3000; // 3秒
        const staleThreshold = 24 * 60 * 60 * 1000; // 24小时

        // 按标签分组统计
        const tagStats = {};
        alarms.forEach(alarm => {
            if (!tagStats[alarm.tag]) {
                tagStats[alarm.tag] = {
                    tag: alarm.tag,
                    description: tagDatabase[alarm.tag]?.description || '未知标签',
                    unit: alarm.unit,
                    alarms: [],
                    totalCount: 0,
                    totalDuration: 0,
                    intermittentCount: 0,
                    flashCount: 0,
                    staleCount: 0
                };
            }
            tagStats[alarm.tag].alarms.push(alarm);
            tagStats[alarm.tag].totalCount++;

            const duration = alarm.recoveryTime ?
                (alarm.recoveryTime - alarm.time) :
                (now - alarm.time);
            tagStats[alarm.tag].totalDuration += duration;

            // 判断瞬闪报警
            if (duration <= flashThreshold) {
                tagStats[alarm.tag].flashCount++;
            }

            // 判断陈旧报警
            if (duration >= staleThreshold) {
                tagStats[alarm.tag].staleCount++;
            }
        });

        // 计算间歇报警
        Object.values(tagStats).forEach(stat => {
            // 简化的间歇报警判断：按时间窗口统计
            const timeWindows = {};
            stat.alarms.forEach(alarm => {
                const windowKey = Math.floor(alarm.time.getTime() / 60000); // 分钟级窗口
                timeWindows[windowKey] = (timeWindows[windowKey] || 0) + 1;
            });

            stat.intermittentCount = Object.values(timeWindows).filter(count => count >= intermittentThreshold).length;
        });

        // 排序和分类
        const allTags = Object.values(tagStats);
        const intermittent = allTags.filter(t => t.intermittentCount > 0)
            .sort((a, b) => b.intermittentCount - a.intermittentCount);
        const flash = allTags.filter(t => t.flashCount > 0)
            .sort((a, b) => b.flashCount - a.flashCount);
        const stale = allTags.filter(t => t.staleCount > 0)
            .sort((a, b) => b.staleCount - a.staleCount);
        const top = allTags.sort((a, b) => b.totalCount - a.totalCount);

        // 滋扰报警综合统计
        const nuisanceAlarms = alarms.filter(a => {
            const duration = a.recoveryTime ? (a.recoveryTime - a.time) : (now - a.time);
            return duration <= flashThreshold || duration >= staleThreshold || a.nuisance;
        });

        const nuisance = {
            count: nuisanceAlarms.length,
            duration: nuisanceAlarms.reduce((sum, a) => {
                const duration = a.recoveryTime ? (a.recoveryTime - a.time) : (now - a.time);
                return sum + duration;
            }, 0),
            countRatio: alarms.length > 0 ? (nuisanceAlarms.length / alarms.length * 100) : 0,
            timeRatio: 0 // 需要总时长来计算
        };

        return { intermittent, flash, stale, nuisance, top, allTags };
    }

    function updateIntermittentAnalysis(intermittentData) {
        // 更新图表
        if (charts.intermittentChart) {
            const top10 = intermittentData.slice(0, 10);
            charts.intermittentChart.data.labels = top10.map(d => d.tag);
            charts.intermittentChart.data.datasets[0].data = top10.map(d => d.intermittentCount);
            charts.intermittentChart.update('none');
        }

        // 更新列表
        const listBody = document.getElementById('intermittent-list');
        if (listBody) {
            listBody.innerHTML = intermittentData.slice(0, 20).map((item, index) => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-semibold">${index + 1}</td>
                    <td class="p-3 font-mono">${item.tag}</td>
                    <td class="p-3">${item.description}</td>
                    <td class="p-3 text-amber-600 font-semibold">${item.intermittentCount}</td>
                    <td class="p-3">${(item.totalDuration / 3600000).toFixed(1)}小时</td>
                    <td class="p-3">${(item.totalDuration / item.totalCount / 60000).toFixed(1)}分钟</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline text-xs" onclick="viewAlarmDetails('${item.tag}')">查看详情</button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateFlashAnalysis(flashData) {
        // 更新图表
        if (charts.flashChart) {
            const top10 = flashData.slice(0, 10);
            charts.flashChart.data.labels = top10.map(d => d.tag);
            charts.flashChart.data.datasets[0].data = top10.map(d => d.flashCount);
            charts.flashChart.update('none');
        }

        // 更新列表
        const listBody = document.getElementById('flash-list');
        if (listBody) {
            listBody.innerHTML = flashData.slice(0, 20).map((item, index) => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-semibold">${index + 1}</td>
                    <td class="p-3 font-mono">${item.tag}</td>
                    <td class="p-3">${item.description}</td>
                    <td class="p-3 text-blue-600 font-semibold">${item.flashCount}</td>
                    <td class="p-3">${(item.totalDuration / 3600000).toFixed(1)}小时</td>
                    <td class="p-3">${(item.totalDuration / item.totalCount / 1000).toFixed(1)}秒</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline text-xs" onclick="viewAlarmDetails('${item.tag}')">查看详情</button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateStaleAnalysis(staleData) {
        // 更新图表 - 显示每日陈旧报警数量
        if (charts.staleChart) {
            const { currentAlarms, periodDays, currentPeriodStart } = getFilteredData('diagnostics-time-filter', 'diagnostics-unit-filter');
            const dailyStale = [];
            const labels = [];

            for (let i = 0; i < periodDays; i++) {
                const dayStart = new Date(currentPeriodStart.getTime() + i * 86400000);
                const dayEnd = new Date(dayStart.getTime() + 86400000);
                labels.push(`${dayStart.getMonth()+1}/${dayStart.getDate()}`);

                const dayStaleCount = currentAlarms.filter(a => {
                    const duration = a.recoveryTime ? (a.recoveryTime - a.time) : (new Date() - a.time);
                    return a.time >= dayStart && a.time < dayEnd && duration >= 24 * 60 * 60 * 1000;
                }).length;

                dailyStale.push(dayStaleCount);
            }

            charts.staleChart.data.labels = labels;
            charts.staleChart.data.datasets[0].data = dailyStale;
            charts.staleChart.update('none');
        }

        // 更新列表
        const listBody = document.getElementById('stale-list');
        if (listBody) {
            const staleAlarms = [];
            staleData.forEach(tagStat => {
                tagStat.alarms.forEach(alarm => {
                    const duration = alarm.recoveryTime ? (alarm.recoveryTime - alarm.time) : (new Date() - alarm.time);
                    if (duration >= 24 * 60 * 60 * 1000) {
                        staleAlarms.push({
                            ...alarm,
                            duration: duration,
                            tag: tagStat.tag,
                            description: tagStat.description
                        });
                    }
                });
            });

            listBody.innerHTML = staleAlarms.slice(0, 20).map(alarm => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-mono">${alarm.tag}</td>
                    <td class="p-3">${alarm.description}</td>
                    <td class="p-3">${alarm.time.toLocaleString('zh-CN')}</td>
                    <td class="p-3">${alarm.recoveryTime ? alarm.recoveryTime.toLocaleString('zh-CN') : '未恢复'}</td>
                    <td class="p-3 text-red-600 font-semibold">${(alarm.duration / 3600000).toFixed(1)}小时</td>
                    <td class="p-3">
                        <span class="status-badge ${alarm.recoveryTime ? 'status-closed' : 'status-new'}">
                            ${alarm.recoveryTime ? '已恢复' : '进行中'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateNuisanceAnalysis(nuisanceData) {
        // 更新统计卡片
        document.getElementById('nuisance-count').textContent = nuisanceData.count;
        document.getElementById('nuisance-duration').textContent = `${(nuisanceData.duration / 3600000).toFixed(1)}小时`;
        document.getElementById('nuisance-count-ratio').textContent = `${nuisanceData.countRatio.toFixed(1)}%`;
        document.getElementById('nuisance-time-ratio').textContent = `${nuisanceData.timeRatio.toFixed(1)}%`;

        // 更新趋势图
        if (charts.nuisanceTrendChart) {
            const { currentAlarms, periodDays, currentPeriodStart } = getFilteredData('diagnostics-time-filter', 'diagnostics-unit-filter');
            const labels = [];
            const nuisanceCounts = [];
            const nuisanceRatios = [];

            for (let i = 0; i < Math.min(periodDays, 14); i++) {
                const dayStart = new Date(currentPeriodStart.getTime() + i * 86400000);
                const dayEnd = new Date(dayStart.getTime() + 86400000);
                labels.push(`${dayStart.getMonth()+1}/${dayStart.getDate()}`);

                const dayAlarms = currentAlarms.filter(a => a.time >= dayStart && a.time < dayEnd);
                const dayNuisance = dayAlarms.filter(a => a.nuisance).length;

                nuisanceCounts.push(dayNuisance);
                nuisanceRatios.push(dayAlarms.length > 0 ? (dayNuisance / dayAlarms.length * 100) : 0);
            }

            charts.nuisanceTrendChart.data.labels = labels;
            charts.nuisanceTrendChart.data.datasets[0].data = nuisanceCounts;
            charts.nuisanceTrendChart.data.datasets[1].data = nuisanceRatios;
            charts.nuisanceTrendChart.update('none');
        }
    }

    function updateTopAnalysis(topData) {
        const topN = parseInt(document.getElementById('top-n-select')?.value || 10);
        const totalAlarms = topData.reduce((sum, item) => sum + item.totalCount, 0);

        // 更新列表
        const listBody = document.getElementById('top-list');
        if (listBody) {
            listBody.innerHTML = topData.slice(0, topN).map((item, index) => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-semibold">${index + 1}</td>
                    <td class="p-3 font-mono">${item.tag}</td>
                    <td class="p-3">${item.description}</td>
                    <td class="p-3 text-purple-600 font-semibold">${item.totalCount}</td>
                    <td class="p-3">${(item.totalDuration / 3600000).toFixed(1)}小时</td>
                    <td class="p-3 text-purple-600">${totalAlarms > 0 ? (item.totalCount / totalAlarms * 100).toFixed(1) : 0}%</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline text-xs" onclick="viewAlarmDetails('${item.tag}')">查看详情</button>
                    </td>
                </tr>
            `).join('');
        }
    }

    function updateShelveManagement() {
        // 模拟搁置数据
        const shelvedAlarms = [
            {
                tag: '80PIC11906',
                name: 'R-2002反应器压力高报警',
                startTime: '2024-01-15 08:00:00',
                endTime: '2024-01-20 08:00:00',
                reason: '设备检修期间',
                applicant: '工程师A',
                approver: '主管B',
                status: '生效中'
            }
        ];

        document.getElementById('shelved-count').textContent = shelvedAlarms.length;

        const listBody = document.getElementById('shelve-list');
        if (listBody) {
            listBody.innerHTML = shelvedAlarms.map(item => `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3 font-mono">${item.tag}</td>
                    <td class="p-3">${item.name}</td>
                    <td class="p-3">${item.startTime}</td>
                    <td class="p-3">${item.endTime}</td>
                    <td class="p-3">${item.reason}</td>
                    <td class="p-3">${item.applicant}</td>
                    <td class="p-3">${item.approver}</td>
                    <td class="p-3">
                        <span class="status-badge status-analyzed">${item.status}</span>
                    </td>
                    <td class="p-3">
                        <button class="text-red-600 hover:underline text-xs" onclick="cancelShelve('${item.tag}')">取消搁置</button>
                    </td>
                </tr>
            `).join('');
        }
    }

    // 辅助函数
    function viewAlarmDetails(tag) {
        alert(`查看标签 ${tag} 的详细报警记录`);
    }

    function cancelShelve(tag) {
        if (confirm(`确定要取消标签 ${tag} 的搁置吗？`)) {
            alert(`已取消标签 ${tag} 的搁置`);
            updateShelveManagement();
        }
    }

    function updateAnalysisCenterUI() {
        const { currentAlarms, periodDays, currentPeriodStart } = getFilteredData('analysis-time-filter', 'analysis-unit-filter');
        const dimension = document.getElementById('analysis-dimension-filter').value;

        // 生成时间序列数据
        const timeSeriesData = generateTimeSeriesData(currentAlarms, dimension, periodDays, currentPeriodStart);

        // 更新各个图表
        updateAnalysisCharts(timeSeriesData);

        // 更新分析摘要
        updateAnalysisSummary(timeSeriesData);
    }

    function generateTimeSeriesData(alarms, dimension, periodDays, startTime) {
        const timeUnit = dimension === 'daily' ? 'day' : dimension === 'weekly' ? 'week' : 'month';
        const msInUnit = timeUnit === 'day' ? 86400000 : timeUnit === 'week' ? 604800000 : 2592000000;
        const unitsInPeriod = timeUnit === 'day' ? periodDays : timeUnit === 'week' ? Math.ceil(periodDays / 7) : Math.ceil(periodDays / 30);

        const labels = [];
        const data = {
            alarmCounts: [],
            nuisanceAlarms: [],
            nuisanceRatio: [],
            top10Counts: [],
            top10Ratio: [],
            peakValues: [],
            floodCounts: [],
            floodRatio: [],
            ackCounts: [],
            ackRates: [],
            resolveCounts: [],
            resolveRates: [],
            avgAckTime: [],
            avgResolveTime: []
        };

        // 计算TOP10标签
        const alarmCounts = {};
        alarms.forEach(a => alarmCounts[a.tag] = (alarmCounts[a.tag] || 0) + 1);
        const top10Tags = Object.entries(alarmCounts).sort((a,b) => b[1] - a[1]).slice(0, 10).map(([tag]) => tag);

        for (let i = 0; i < unitsInPeriod; i++) {
            const unitStart = new Date(startTime.getTime() + i * msInUnit);
            const unitEnd = new Date(unitStart.getTime() + msInUnit);

            // 生成标签
            if (timeUnit === 'day') {
                labels.push(`${unitStart.getMonth()+1}/${unitStart.getDate()}`);
            } else if (timeUnit === 'week') {
                labels.push(`第${Math.floor(unitStart.getTime() / 604800000) % 52 + 1}周`);
            } else {
                labels.push(`${unitStart.getFullYear()}/${unitStart.getMonth()+1}`);
            }

            // 筛选当前时间段的报警
            const periodAlarms = alarms.filter(a => a.time >= unitStart && a.time < unitEnd);

            // 基础统计
            data.alarmCounts.push(periodAlarms.length);

            // 滋扰报警统计
            const nuisanceCount = periodAlarms.filter(a => a.nuisance).length;
            data.nuisanceAlarms.push(nuisanceCount);
            data.nuisanceRatio.push(periodAlarms.length > 0 ? (nuisanceCount / periodAlarms.length * 100) : 0);

            // TOP10统计
            const top10Count = periodAlarms.filter(a => top10Tags.includes(a.tag)).length;
            data.top10Counts.push(top10Count);
            data.top10Ratio.push(periodAlarms.length > 0 ? (top10Count / periodAlarms.length * 100) : 0);

            // 峰值计算
            let maxPeak = 0;
            for (let j = 0; j < periodAlarms.length; j++) {
                let countIn10Min = 1;
                for (let k = j + 1; k < periodAlarms.length; k++) {
                    if ((periodAlarms[k].time - periodAlarms[j].time) < 600000) countIn10Min++;
                    else break;
                }
                if (countIn10Min > maxPeak) maxPeak = countIn10Min;
            }
            data.peakValues.push(maxPeak);

            // 泛滥统计
            const floodCount = periodAlarms.filter((_, idx) => {
                let countIn10Min = 1;
                for (let k = idx + 1; k < periodAlarms.length; k++) {
                    if ((periodAlarms[k].time - periodAlarms[idx].time) < 600000) countIn10Min++;
                    else break;
                }
                return countIn10Min > 10;
            }).length;
            data.floodCounts.push(floodCount);
            data.floodRatio.push(periodAlarms.length > 0 ? (floodCount / periodAlarms.length * 100) : 0);

            // 确认和处置统计
            const ackedAlarms = periodAlarms.filter(a => a.ackTime);
            const resolvedAlarms = periodAlarms.filter(a => a.recoveryTime);

            data.ackCounts.push(ackedAlarms.length);
            data.ackRates.push(periodAlarms.length > 0 ? (ackedAlarms.length / periodAlarms.length * 100) : 0);
            data.resolveCounts.push(resolvedAlarms.length);
            data.resolveRates.push(periodAlarms.length > 0 ? (resolvedAlarms.length / periodAlarms.length * 100) : 0);

            // 平均时长计算
            const avgAck = ackedAlarms.length > 0 ?
                ackedAlarms.reduce((sum, a) => sum + (a.ackTime - a.time), 0) / ackedAlarms.length / 60000 : 0;
            const avgResolve = resolvedAlarms.length > 0 ?
                resolvedAlarms.reduce((sum, a) => sum + (a.recoveryTime - a.time), 0) / resolvedAlarms.length / 60000 : 0;

            data.avgAckTime.push(Math.round(avgAck));
            data.avgResolveTime.push(Math.round(avgResolve));
        }

        return { labels, data };
    }

    function updateAnalysisCharts(timeSeriesData) {
        const { labels, data } = timeSeriesData;

        // 生成预测数据
        const generatePrediction = (dataArray) => {
            if (dataArray.length < 3) return Array(dataArray.length).fill(null);
            const prediction = Array(dataArray.length).fill(null);
            const lastThree = dataArray.slice(-3);
            const trend = (lastThree[2] - lastThree[0]) / 2;
            prediction[dataArray.length - 1] = dataArray[dataArray.length - 1];
            if (dataArray.length < labels.length) {
                prediction.push(Math.max(0, dataArray[dataArray.length - 1] + trend));
            }
            return prediction;
        };

        // 更新报警数量趋势图
        if (charts.alarmCountTrendChart) {
            charts.alarmCountTrendChart.data.labels = labels;
            charts.alarmCountTrendChart.data.datasets[0].data = data.alarmCounts;
            charts.alarmCountTrendChart.data.datasets[1].data = generatePrediction(data.alarmCounts);
            charts.alarmCountTrendChart.update('none');
        }

        // 更新滋扰报警趋势图
        if (charts.nuisanceAlarmTrendChart) {
            charts.nuisanceAlarmTrendChart.data.labels = labels;
            charts.nuisanceAlarmTrendChart.data.datasets[0].data = data.nuisanceAlarms;
            charts.nuisanceAlarmTrendChart.data.datasets[1].data = data.nuisanceRatio;
            charts.nuisanceAlarmTrendChart.update('none');
        }

        // 更新TOP10趋势图
        if (charts.top10TrendChart) {
            charts.top10TrendChart.data.labels = labels;
            charts.top10TrendChart.data.datasets[0].data = data.top10Counts;
            charts.top10TrendChart.data.datasets[1].data = data.top10Ratio;
            charts.top10TrendChart.update('none');
        }

        // 更新10min峰值趋势图
        if (charts.peakTrendChart) {
            charts.peakTrendChart.data.labels = labels;
            charts.peakTrendChart.data.datasets[0].data = data.peakValues;
            charts.peakTrendChart.data.datasets[1].data = generatePrediction(data.peakValues);
            charts.peakTrendChart.update('none');
        }

        // 更新报警泛滥趋势图
        if (charts.floodTrendChart) {
            charts.floodTrendChart.data.labels = labels;
            charts.floodTrendChart.data.datasets[0].data = data.floodCounts;
            charts.floodTrendChart.data.datasets[1].data = data.floodRatio;
            charts.floodTrendChart.update('none');
        }

        // 更新报警确认趋势图
        if (charts.ackTrendChart) {
            charts.ackTrendChart.data.labels = labels;
            charts.ackTrendChart.data.datasets[0].data = data.ackCounts;
            charts.ackTrendChart.data.datasets[1].data = data.ackRates;
            charts.ackTrendChart.update('none');
        }

        // 更新报警处置趋势图
        if (charts.resolveTrendChart) {
            charts.resolveTrendChart.data.labels = labels;
            charts.resolveTrendChart.data.datasets[0].data = data.resolveCounts;
            charts.resolveTrendChart.data.datasets[1].data = data.resolveRates;
            charts.resolveTrendChart.update('none');
        }

        // 更新处置时长趋势图
        if (charts.durationTrendChart) {
            charts.durationTrendChart.data.labels = labels;
            charts.durationTrendChart.data.datasets[0].data = data.avgAckTime;
            charts.durationTrendChart.data.datasets[1].data = data.avgResolveTime;
            charts.durationTrendChart.update('none');
        }
    }

    function updateAnalysisSummary(timeSeriesData) {
        const { data } = timeSeriesData;

        // 计算趋势
        const calculateTrend = (dataArray) => {
            if (dataArray.length < 2) return 0;
            const recent = dataArray.slice(-3);
            const earlier = dataArray.slice(0, 3);
            const recentAvg = recent.reduce((a, b) => a + b, 0) / recent.length;
            const earlierAvg = earlier.reduce((a, b) => a + b, 0) / earlier.length;
            return ((recentAvg - earlierAvg) / earlierAvg * 100).toFixed(1);
        };

        // 报警总体趋势
        const alarmTrend = calculateTrend(data.alarmCounts);
        const alarmTrendText = alarmTrend > 0 ? `上升${alarmTrend}%` : alarmTrend < 0 ? `下降${Math.abs(alarmTrend)}%` : '保持稳定';
        document.getElementById('alarm-trend-summary').textContent =
            `报警数量呈${alarmTrendText}趋势，当前峰值为${Math.max(...data.peakValues)}条/10分钟`;

        // 滋扰报警状况
        const nuisanceAvg = (data.nuisanceRatio.reduce((a, b) => a + b, 0) / data.nuisanceRatio.length).toFixed(1);
        const nuisanceTrend = calculateTrend(data.nuisanceRatio);
        document.getElementById('nuisance-trend-summary').textContent =
            `滋扰报警占比平均${nuisanceAvg}%，趋势${nuisanceTrend > 0 ? '上升' : nuisanceTrend < 0 ? '下降' : '稳定'}`;

        // 处置效率
        const ackRateAvg = (data.ackRates.reduce((a, b) => a + b, 0) / data.ackRates.length).toFixed(1);
        const resolveRateAvg = (data.resolveRates.reduce((a, b) => a + b, 0) / data.resolveRates.length).toFixed(1);
        document.getElementById('efficiency-trend-summary').textContent =
            `平均确认率${ackRateAvg}%，平均处置率${resolveRateAvg}%`;

        // 预测建议
        const alarmPrediction = alarmTrend > 10 ? '建议加强预防措施' :
                              alarmTrend < -10 ? '报警管理效果良好' : '保持当前管理水平';
        document.getElementById('prediction-summary').textContent = alarmPrediction;
    }

    function getFilteredData(timeFilterId, unitFilterId) {
        const timeFilter = document.getElementById(timeFilterId).value;
        const unitFilter = document.getElementById(unitFilterId).value;
        const periodDays = { day: 1, week: 7, month: 30 }[timeFilter];
        const now = new Date();
        const currentPeriodEnd = now;
        const currentPeriodStart = new Date(now.getTime() - periodDays * 24 * 3600 * 1000);
        const prevPeriodEnd = currentPeriodStart;
        const prevPeriodStart = new Date(prevPeriodEnd.getTime() - periodDays * 24 * 3600 * 1000);

        // 改进的过滤逻辑，支持层级装置关系
        const filterLogic = (log) => {
            if (unitFilter === 'all') return true;
            if (log.unit === unitFilter) return true;
            // 检查是否为子装置
            const unitInfo = factoryModel[log.unit];
            return unitInfo && unitInfo.parent === unitFilter;
        };

        const currentAlarms = fullAlarmLog.filter(a => a.time >= currentPeriodStart && a.time < currentPeriodEnd && filterLogic(a));
        const prevAlarms = fullAlarmLog.filter(a => a.time >= prevPeriodStart && a.time < prevPeriodEnd && filterLogic(a));
        return { currentAlarms, prevAlarms, periodDays, now, currentPeriodStart };
    }
    
    function calculateRatio(current, previous) {
        if (previous === 0) return { text: ' (vs 0)', class: 'text-slate-500' };
        const ratio = ((current - previous) / previous) * 100;
        const symbol = ratio >= 0 ? '↑' : '↓';
        const colorClass = ratio >= 0 ? 'ratio-up' : 'ratio-down';
        return { text: `${symbol} ${Math.abs(ratio).toFixed(1)}%`, class: colorClass };
    }

    function updateMonitoringUI() {
        const { currentAlarms, prevAlarms, periodDays, currentPeriodStart } = getFilteredData('monitoring-time-filter', 'monitoring-unit-filter');
        
        // --- KPI Calculations ---
        const totalAlarms = currentAlarms.length;
        document.getElementById('kpi-total-alarms').textContent = totalAlarms;
        const totalRatioEl = document.getElementById('kpi-total-alarms-ratio');
        const totalRatio = calculateRatio(totalAlarms, prevAlarms.length);
        totalRatioEl.textContent = totalRatio.text;
        totalRatioEl.className = `text-xs ${totalRatio.class}`;

        const hourlyAlarms = totalAlarms / (periodDays * 24);
        document.getElementById('kpi-hourly-alarms').textContent = hourlyAlarms.toFixed(1);
        const hourlyRatioEl = document.getElementById('kpi-hourly-alarms-ratio');
        const hourlyRatio = calculateRatio(hourlyAlarms, prevAlarms.length / (periodDays * 24));
        hourlyRatioEl.textContent = hourlyRatio.text;
        hourlyRatioEl.className = `text-xs ${hourlyRatio.class}`;
        
        let peakCount = 0, floodCount = 0, floodMinutes = new Set();
        for (let i = 0; i < currentAlarms.length; i++) { let countIn10Min = 1; for (let j = i + 1; j < currentAlarms.length; j++) { if ((currentAlarms[j].time - currentAlarms[i].time) < 600000) countIn10Min++; else break; } if (countIn10Min > peakCount) peakCount = countIn10Min; if (countIn10Min > 10) { floodCount++; const minuteKey = Math.floor(currentAlarms[i].time.getTime() / 600000); floodMinutes.add(minuteKey); } }
        document.getElementById('kpi-peak-rate').textContent = peakCount;
        document.getElementById('kpi-flood-count').textContent = floodCount;
        const floodPercent = (floodMinutes.size * 10) / (periodDays * 24 * 60) * 100;
        document.getElementById('kpi-flood-percent').textContent = `${floodPercent.toFixed(1)}%`;
        const nuisanceAlarms = currentAlarms.filter(a => a.nuisance).length;
        document.getElementById('kpi-nuisance-alarms').textContent = nuisanceAlarms;
        const nuisanceRatioEl = document.getElementById('kpi-nuisance-alarms-ratio');
        const nuisanceRatio = calculateRatio(nuisanceAlarms, prevAlarms.filter(a => a.nuisance).length);
        nuisanceRatioEl.textContent = nuisanceRatio.text;
        nuisanceRatioEl.className = `text-xs ${nuisanceRatio.class}`;
        const nuisancePercent = totalAlarms > 0 ? (nuisanceAlarms / totalAlarms) * 100 : 0;
        document.getElementById('kpi-nuisance-percent').textContent = `${nuisancePercent.toFixed(1)}%`;

        // --- Chart Updates ---
        updateChartsWithData(currentAlarms, periodDays, currentPeriodStart);
    }

    function updateChartsWithData(currentAlarms, periodDays, currentPeriodStart) {
        // 优先级分布图
        if (charts.priorityChart) {
            const priorityCounts = { '紧急': 0, '重要': 0, '一般': 0 };
            currentAlarms.forEach(a => priorityCounts[a.priority]++);
            charts.priorityChart.data.datasets[0].data = Object.values(priorityCounts);
            charts.priorityChart.update('none'); // 使用 'none' 模式提高性能
        }

        // Top 10 报警图
        if (charts.topAlarmsChart) {
            const alarmCounts = {};
            currentAlarms.forEach(a => alarmCounts[a.tag] = (alarmCounts[a.tag] || 0) + 1);
            const sortedAlarms = Object.entries(alarmCounts).sort((a,b) => b[1] - a[1]).slice(0, 10);
            charts.topAlarmsChart.data.labels = sortedAlarms.map(a => a[0]).reverse();
            charts.topAlarmsChart.data.datasets[0].data = sortedAlarms.map(a => a[1]).reverse();
            charts.topAlarmsChart.update('none');
        }

        // 树图
        if (charts.treemapChart) {
            const unitCounts = {};
            currentAlarms.forEach(a => unitCounts[a.unit] = (unitCounts[a.unit] || 0) + 1);
            const treeData = Object.entries(unitCounts).map(([unit, value]) => ({ unit, value }));
            charts.treemapChart.data.datasets[0].tree = treeData;
            charts.treemapChart.update('none');
        }

        // 趋势图 - 修复时间处理和预测逻辑
        if (charts.trendChart) {
            const aggregationUnit = periodDays === 1 ? 'hour' : 'day';
            const msInUnit = aggregationUnit === 'hour' ? 3600000 : 86400000;
            const unitsInPeriod = aggregationUnit === 'hour' ? 24 : periodDays;

            // 生成时间标签
            const trendLabels = [];
            for (let i = 0; i < unitsInPeriod; i++) {
                const unitStart = new Date(currentPeriodStart.getTime() + i * msInUnit);
                if (aggregationUnit === 'hour') {
                    trendLabels.push(`${unitStart.getHours().toString().padStart(2, '0')}:00`);
                } else {
                    trendLabels.push(`${unitStart.getMonth()+1}/${unitStart.getDate()}`);
                }
            }

            // 计算实际数据
            const trendData = Array(unitsInPeriod).fill(0);
            currentAlarms.forEach(a => {
                const unitIndex = Math.floor((a.time - currentPeriodStart) / msInUnit);
                if (unitIndex >= 0 && unitIndex < trendData.length) {
                    trendData[unitIndex]++;
                }
            });

            // 生成简单的预测数据（基于最近几个数据点的趋势）
            const predictionData = Array(unitsInPeriod).fill(null);
            if (trendData.length >= 3) {
                const lastThreeValues = trendData.slice(-3).filter(v => v > 0);
                if (lastThreeValues.length >= 2) {
                    const avgTrend = lastThreeValues.reduce((sum, val, idx, arr) => {
                        if (idx === 0) return 0;
                        return sum + (val - arr[idx - 1]);
                    }, 0) / (lastThreeValues.length - 1);

                    // 为最后几个点添加预测值
                    const lastValue = trendData[trendData.length - 1];
                    predictionData[trendData.length - 1] = lastValue;
                    if (trendData.length < unitsInPeriod) {
                        predictionData[trendData.length] = Math.max(0, lastValue + avgTrend);
                    }
                }
            }

            charts.trendChart.data.labels = trendLabels;
            charts.trendChart.data.datasets[0].data = trendData;
            charts.trendChart.data.datasets[1].data = predictionData;
            charts.trendChart.update('none');
        }
    }

    function updateActionCenterUI() {
        const { currentAlarms } = getFilteredData('action-time-filter', 'action-unit-filter');

        // 缓存计算结果以提高性能
        const alarmStats = calculateAlarmStats(currentAlarms);

        // 更新KPIs
        updateActionKPIs(alarmStats);

        // 更新报警列表
        updateActionList(currentAlarms);

        // 更新分析图表
        updateActionCharts(currentAlarms);
    }

    function calculateAlarmStats(alarms) {
        let pendingCount = 0, overdueAck = 0, overdueRes = 0, timelyAck = 0, timelyRes = 0;

        alarms.forEach(a => {
            if (a.status === '新报警') pendingCount++;
            const params = alarmParameters[a.tag];
            if (params) {
                const ackSeconds = (a.ackTime - a.time) / 1000;
                const resSeconds = a.recoveryTime ? (a.recoveryTime - a.time) / 1000 : Infinity;
                if (ackSeconds > params.maxAckTime) overdueAck++; else timelyAck++;
                if (resSeconds > params.maxResTime) overdueRes++; else timelyRes++;
            }
        });

        return { pendingCount, overdueAck, overdueRes, timelyAck, timelyRes };
    }

    function updateActionKPIs(stats) {
        document.getElementById('action-kpi-total').textContent =
            document.getElementById('action-time-filter') ?
            getFilteredData('action-time-filter', 'action-unit-filter').currentAlarms.length : 0;
        document.getElementById('action-kpi-pending').textContent = stats.pendingCount;
        document.getElementById('action-kpi-overdue-ack').textContent = stats.overdueAck;
        document.getElementById('action-kpi-overdue-res').textContent = stats.overdueRes;

        const ackRate = (stats.timelyAck + stats.overdueAck) > 0 ?
            (stats.timelyAck / (stats.timelyAck + stats.overdueAck) * 100) : 100;
        const resRate = (stats.timelyRes + stats.overdueRes) > 0 ?
            (stats.timelyRes / (stats.timelyRes + stats.overdueRes) * 100) : 100;

        document.getElementById('action-kpi-ack-rate').textContent = `${ackRate.toFixed(1)}%`;
        document.getElementById('action-kpi-res-rate').textContent = `${resRate.toFixed(1)}%`;
    }

    function updateActionList(currentAlarms) {
        const listBody = document.getElementById('action-list-body');
        if (!listBody) return;

        // 保存当前选中状态
        const checkedIds = new Set();
        listBody.querySelectorAll('.alarm-checkbox:checked').forEach(cb => {
            checkedIds.add(cb.dataset.id);
        });

        // 更新列表内容
        listBody.innerHTML = currentAlarms.slice(0, 20).map(a => `
            <tr class="border-b hover:bg-slate-50">
                <td class="p-2"><input type="checkbox" class="alarm-checkbox" data-id="${a.id}" ${checkedIds.has(a.id.toString()) ? 'checked' : ''}></td>
                <td class="p-2 font-mono">${a.tag}</td>
                <td class="p-2">${a.description}</td>
                <td class="p-2">${a.time.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                })}</td>
                <td class="p-2"><span class="status-badge status-${a.status === '新报警' ? 'new' : (a.status === '已处置' ? 'analyzed' : 'closed')}">${a.status}</span></td>
                <td class="p-2 space-x-2">
                    <button class="text-sky-600 hover:underline text-xs action-btn" data-id="${a.id}" data-type="analyze">处置</button>
                    <button class="text-green-600 hover:underline text-xs action-btn" data-id="${a.id}" data-type="verify" ${a.status !== '已处置' ? 'disabled' : ''}>验证</button>
                </td>
            </tr>
        `).join('');

        // 更新批量操作按钮状态
        toggleBatchBtn();
    }

    function updateActionCharts(currentAlarms) {
        const units = [...new Set(currentAlarms.map(a => a.unit))];
        const ackRateByUnit = [], resRateByUnit = [];

        units.forEach(unit => {
            const unitAlarms = currentAlarms.filter(a => a.unit === unit);
            let timelyAck = 0, totalAck = 0, timelyRes = 0, totalRes = 0;

            unitAlarms.forEach(a => {
                const params = alarmParameters[a.tag];
                if (params) {
                    totalAck++;
                    totalRes++;
                    if ((a.ackTime - a.time) / 1000 <= params.maxAckTime) timelyAck++;
                    if (a.recoveryTime && (a.recoveryTime - a.time) / 1000 <= params.maxResTime) timelyRes++;
                }
            });

            ackRateByUnit.push(totalAck > 0 ? (timelyAck / totalAck * 100) : 100);
            resRateByUnit.push(totalRes > 0 ? (timelyRes / totalRes * 100) : 100);
        });

        if (charts.ackRateChart) {
            charts.ackRateChart.data.labels = units;
            charts.ackRateChart.data.datasets[0].data = ackRateByUnit;
            charts.ackRateChart.update('none');
        }
        if (charts.resRateChart) {
            charts.resRateChart.data.labels = units;
            charts.resRateChart.data.datasets[0].data = resRateByUnit;
            charts.resRateChart.update('none');
        }
    }

    // --- Event Listeners ---
    document.querySelectorAll('.filter-control').forEach(el => el.addEventListener('change', () => {
        const activeSection = document.querySelector('.nav-item.active').dataset.target;
        if (activeSection === 'monitoring') updateMonitoringUI();
        else if (activeSection === 'action') updateActionCenterUI();
        else if (activeSection === 'analysis') updateAnalysisCenterUI();
        else if (activeSection === 'diagnostics') updateDiagnosticsCenterUI();
        else if (activeSection === 'evaluation') updateEvaluationCenterUI();
        else if (activeSection === 'reporting') updateReportingCenterUI();
        else if (activeSection === 'config') updateConfigurationCenterUI();
        else if (activeSection === 'history') updateHistoryCenterUI();
    }));

    // 分析中心维度筛选器
    document.addEventListener('change', (e) => {
        if (e.target.id === 'analysis-dimension-filter') {
            const activeSection = document.querySelector('.nav-item.active').dataset.target;
            if (activeSection === 'analysis') updateAnalysisCenterUI();
        }

        // 诊断中心TOP-N选择器
        if (e.target.id === 'top-n-select') {
            const activeSection = document.querySelector('.nav-item.active').dataset.target;
            if (activeSection === 'diagnostics') {
                const { currentAlarms } = getFilteredData('diagnostics-time-filter', 'diagnostics-unit-filter');
                const diagnosticsData = analyzeDiagnosticsData(currentAlarms);
                updateTopAnalysis(diagnosticsData.top);
            }
        }
    });

    // 诊断中心标签页切换
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('diagnostics-tab-btn')) {
            const targetTab = e.target.dataset.tab;

            // 更新标签页按钮状态
            document.querySelectorAll('.diagnostics-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');

            // 切换标签页内容
            document.querySelectorAll('.diagnostics-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
        }

        // 新增搁置按钮
        if (e.target.id === 'add-shelve-btn') {
            alert('新增搁置功能 - 这里可以打开搁置申请表单');
        }

        // 评估中心标签页切换
        if (e.target.classList.contains('evaluation-tab-btn')) {
            const targetTab = e.target.dataset.tab;

            // 更新标签页按钮状态
            document.querySelectorAll('.evaluation-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');

            // 切换标签页内容
            document.querySelectorAll('.evaluation-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
        }

        // 评估中心按钮事件
        if (e.target.id === 'export-audit-btn') {
            alert('导出审计报告功能');
        }

        if (e.target.id === 'refresh-audit-btn') {
            alert('重新执行参数审计');
            updateEvaluationCenterUI();
        }

        // 报告中心按钮事件
        if (e.target.id === 'generate-report-btn') {
            generateReport();
        }

        if (e.target.id === 'export-report-btn') {
            exportReport();
        }

        // 基础配置标签页切换
        if (e.target.classList.contains('config-tab-btn')) {
            const targetTab = e.target.dataset.tab;

            // 更新标签页按钮状态
            document.querySelectorAll('.config-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            e.target.classList.add('active');

            // 切换标签页内容
            document.querySelectorAll('.config-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${targetTab}-tab`).classList.remove('hidden');
        }

        // 基础配置按钮事件
        if (e.target.id === 'add-factory-node-btn') {
            showNotification('新增工厂节点功能', 'info');
        }

        if (e.target.id === 'import-factory-btn') {
            importData('工厂模型');
        }

        if (e.target.id === 'export-factory-btn') {
            exportData('工厂模型');
        }

        if (e.target.id === 'add-tag-btn') {
            showNotification('新增标签功能', 'info');
        }

        if (e.target.id === 'import-tags-btn') {
            importData('标签');
        }

        if (e.target.id === 'export-tags-btn') {
            exportData('标签');
        }

        if (e.target.id === 'batch-delete-tags-btn') {
            const selectedTags = document.querySelectorAll('.tag-checkbox:checked');
            if (selectedTags.length === 0) {
                showNotification('请先选择要删除的标签', 'error');
            } else if (confirm(`确定要删除选中的 ${selectedTags.length} 个标签吗？`)) {
                showNotification(`已删除 ${selectedTags.length} 个标签`, 'success');
            }
        }

        if (e.target.id === 'add-alarm-param-btn') {
            showNotification('新增报警参数功能', 'info');
        }

        if (e.target.id === 'batch-config-btn') {
            showNotification('批量配置功能', 'info');
        }

        if (e.target.id === 'import-alarm-params-btn') {
            importData('报警参数');
        }

        if (e.target.id === 'export-alarm-params-btn') {
            exportData('报警参数');
        }

        if (e.target.id === 'save-statistics-config-btn') {
            saveConfiguration();
        }

        // AI功能按钮事件
        if (e.target.id === 'ai-monitoring-analysis-btn') {
            generateMonitoringInsights();
        }

        if (e.target.id === 'ai-action-analysis-btn') {
            generateActionInsights();
        }

        if (e.target.id === 'close-ai-monitoring-insights') {
            document.getElementById('ai-monitoring-insights').classList.add('hidden');
        }

        if (e.target.id === 'close-ai-action-insights') {
            document.getElementById('ai-action-insights').classList.add('hidden');
        }

        // 历史记录按钮事件
        if (e.target.id === 'import-history-btn') {
            importHistoryRecords();
        }

        if (e.target.id === 'export-history-btn') {
            exportHistoryRecords();
        }

        if (e.target.id === 'batch-calculate-btn') {
            batchCalculateHistory();
        }

        if (e.target.id === 'batch-delete-history-btn') {
            batchDeleteHistory();
        }

        if (e.target.id === 'apply-history-filter-btn') {
            updateHistoryCenterUI();
        }

        // 历史记录分页按钮
        if (e.target.id === 'history-first-page') {
            currentHistoryPage = 1;
            updateHistoryRecordsList();
        }

        if (e.target.id === 'history-prev-page') {
            if (currentHistoryPage > 1) {
                currentHistoryPage--;
                updateHistoryRecordsList();
            }
        }

        if (e.target.id === 'history-next-page') {
            const totalPages = Math.ceil(filteredHistoryRecords.length / historyPageSize);
            if (currentHistoryPage < totalPages) {
                currentHistoryPage++;
                updateHistoryRecordsList();
            }
        }

        if (e.target.id === 'history-last-page') {
            const totalPages = Math.ceil(filteredHistoryRecords.length / historyPageSize);
            currentHistoryPage = totalPages;
            updateHistoryRecordsList();
        }
    });

    // 基础配置搜索和筛选事件监听
    document.addEventListener('input', (e) => {
        // 工厂模型搜索
        if (e.target.id === 'factory-search') {
            console.log('工厂模型搜索:', e.target.value);
        }

        // 标签搜索
        if (e.target.id === 'tag-search') {
            console.log('标签搜索:', e.target.value);
        }

        // 报警参数搜索
        if (e.target.id === 'alarm-param-search') {
            console.log('报警参数搜索:', e.target.value);
        }
    });

    document.addEventListener('change', (e) => {
        // 标签类型筛选
        if (e.target.id === 'tag-type-filter') {
            console.log('标签类型筛选:', e.target.value);
        }

        // 报警等级筛选
        if (e.target.id === 'alarm-level-filter') {
            console.log('报警等级筛选:', e.target.value);
        }

        // 全选标签复选框
        if (e.target.id === 'select-all-tags') {
            const checkboxes = document.querySelectorAll('.tag-checkbox');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        }

        // 全选历史记录复选框
        if (e.target.id === 'select-all-history') {
            const checkboxes = document.querySelectorAll('.history-checkbox');
            checkboxes.forEach(cb => cb.checked = e.target.checked);
        }

        // 历史记录页面大小变化
        if (e.target.id === 'history-page-size') {
            currentHistoryPage = 1;
            updateHistoryRecordsList();
        }
    });

    // 评估中心特殊事件监听
    document.addEventListener('change', (e) => {
        // 雷达图装置选择
        if (e.target.id === 'radar-unit-select') {
            const activeSection = document.querySelector('.nav-item.active').dataset.target;
            if (activeSection === 'evaluation') {
                const { currentAlarms } = getFilteredData('evaluation-time-filter', 'evaluation-unit-filter');
                const evaluationData = calculateEvaluationData(currentAlarms);
                updateHealthAssessment(evaluationData.health);
            }
        }

        // 审计筛选器
        if (e.target.id === 'audit-issue-filter' || e.target.id === 'audit-risk-filter') {
            const activeSection = document.querySelector('.nav-item.active').dataset.target;
            if (activeSection === 'evaluation') {
                // 这里可以添加筛选逻辑
                console.log('审计结果筛选');
            }
        }

        // 报告中心参数变化
        if (e.target.id === 'report-type' || e.target.id === 'report-scope' ||
            e.target.id === 'report-start-date' || e.target.id === 'report-end-date') {
            const activeSection = document.querySelector('.nav-item.active').dataset.target;
            if (activeSection === 'reporting') {
                // 参数变化时自动更新报告标题等基本信息
                const reportType = document.getElementById('report-type')?.value || 'monthly';
                const startDate = document.getElementById('report-start-date')?.value || '2024-01-01';
                const endDate = document.getElementById('report-end-date')?.value || '2024-01-31';
                const scope = document.getElementById('report-scope')?.value || 'all';

                const reportData = generateReportData(reportType, startDate, endDate, scope);
                document.getElementById('report-title').textContent = reportData.title;
                document.getElementById('report-subtitle').textContent = reportData.subtitle;
            }
        }
    });
    
    // 左侧导航处理
    document.addEventListener('click', (e) => {
        if (e.target.closest('.nav-item')) {
            const navItem = e.target.closest('.nav-item');
            const targetId = navItem.dataset.target;

            // 更新导航状态
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            navItem.classList.add('active');

            // 切换内容区域
            ['monitoring', 'action', 'analysis', 'diagnostics', 'evaluation', 'reporting', 'history', 'config'].forEach(id => {
                const section = document.getElementById(`${id}-section`);
                if (section) {
                    section.classList.toggle('hidden', id !== targetId);
                }
            });

            // 初始化对应模块
            if (targetId === 'monitoring') {
                initMonitoringCharts();
                updateMonitoringUI();
            } else if (targetId === 'action') {
                initActionCenterCharts();
                updateActionCenterUI();
            } else if (targetId === 'analysis') {
                initAnalysisCenterCharts();
                updateAnalysisCenterUI();
            } else if (targetId === 'diagnostics') {
                initDiagnosticsCenterCharts();
                updateDiagnosticsCenterUI();
            } else if (targetId === 'evaluation') {
                initEvaluationCenterCharts();
                updateEvaluationCenterUI();
            } else if (targetId === 'reporting') {
                initReportingCenterCharts();
                updateReportingCenterUI();
            } else if (targetId === 'config') {
                initConfigurationCenter();
                updateConfigurationCenterUI();
            } else if (targetId === 'history') {
                initHistoryCenter();
                updateHistoryCenterUI();
            }
        }
    });

    // 侧边栏折叠功能
    document.getElementById('sidebar-toggle').addEventListener('click', () => {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.querySelector('.main-content');
        const isCollapsed = sidebar.classList.contains('sidebar-collapsed');

        if (isCollapsed) {
            // 展开
            sidebar.classList.remove('sidebar-collapsed');
            mainContent.style.marginLeft = '240px';
        } else {
            // 折叠
            sidebar.classList.add('sidebar-collapsed');
            mainContent.style.marginLeft = '60px';
        }

        // 更新切换按钮图标
        const toggleIcon = document.querySelector('#sidebar-toggle svg');
        if (isCollapsed) {
            toggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>';
        } else {
            toggleIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"/>';
        }
    });

    // Modal Logic - 使用事件委托避免重复绑定
    const actionModal = document.getElementById('action-modal');
    const verifyModal = document.getElementById('verify-modal');

    // 使用事件委托处理动态生成的按钮
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('action-btn')) {
            const type = e.target.dataset.type;
            const alarmId = e.target.dataset.id;

            if (type === 'analyze') {
                actionModal.classList.remove('hidden');
                actionModal.dataset.alarmId = alarmId;
            } else if (type === 'verify' && !e.target.disabled) {
                verifyModal.classList.remove('hidden');
                verifyModal.dataset.alarmId = alarmId;
            }
        }

        // 处理模态框关闭
        if (e.target.classList.contains('modal-close-btn') || e.target.classList.contains('modal-save-btn')) {
            actionModal.classList.add('hidden');
            verifyModal.classList.add('hidden');
            delete actionModal.dataset.alarmId;
            delete verifyModal.dataset.alarmId;
        }
    });

    // Batch Action Logic - 改进状态管理
    const selectAllCheckbox = document.getElementById('select-all-alarms');
    const batchBtn = document.getElementById('batch-action-btn');

    function toggleBatchBtn() {
        const anyChecked = document.querySelector('.alarm-checkbox:checked');
        if (batchBtn) {
            batchBtn.disabled = !anyChecked;
        }

        // 更新全选复选框状态
        if (selectAllCheckbox) {
            const allCheckboxes = document.querySelectorAll('.alarm-checkbox');
            const checkedCheckboxes = document.querySelectorAll('.alarm-checkbox:checked');

            if (checkedCheckboxes.length === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (checkedCheckboxes.length === allCheckboxes.length) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }
    }

    // 使用事件委托处理复选框变化
    document.addEventListener('change', (e) => {
        if (e.target.id === 'select-all-alarms') {
            document.querySelectorAll('.alarm-checkbox').forEach(cb => {
                cb.checked = e.target.checked;
            });
            toggleBatchBtn();
        } else if (e.target.classList.contains('alarm-checkbox')) {
            toggleBatchBtn();
        }
    });

    if (batchBtn) {
        batchBtn.addEventListener('click', () => {
            const checkedIds = Array.from(document.querySelectorAll('.alarm-checkbox:checked'))
                .map(cb => cb.dataset.id);
            actionModal.classList.remove('hidden');
            actionModal.dataset.batchIds = JSON.stringify(checkedIds);
        });
    }


    // 移动端菜单处理
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const sidebar = document.getElementById('sidebar');
    let mobileOverlay = null;

    function toggleMobileMenu() {
        const isOpen = sidebar.classList.contains('mobile-open');

        if (isOpen) {
            // 关闭菜单
            sidebar.classList.remove('mobile-open');
            if (mobileOverlay) {
                mobileOverlay.remove();
                mobileOverlay = null;
            }
        } else {
            // 打开菜单
            sidebar.classList.add('mobile-open');

            // 创建遮罩层
            mobileOverlay = document.createElement('div');
            mobileOverlay.className = 'mobile-overlay';
            mobileOverlay.addEventListener('click', toggleMobileMenu);
            document.body.appendChild(mobileOverlay);
        }
    }

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    }

    // 窗口大小变化时的处理
    window.addEventListener('resize', () => {
        if (window.innerWidth >= 768) {
            // 桌面端，移除移动端相关类和遮罩
            sidebar.classList.remove('mobile-open');
            if (mobileOverlay) {
                mobileOverlay.remove();
                mobileOverlay = null;
            }
        }
    });

    // --- Initial Load ---
    initMonitoringCharts();
    updateMonitoringUI();

    // 初始化AI助手
    initAIAssistant();

    // LLM服务类
    class LLMService {
        constructor() {
            this.isDemo = true; // 演示模式，使用模拟响应
        }

        async generateResponse(prompt, context = {}) {
            if (this.isDemo) {
                return this.generateMockResponse(prompt, context);
            }

            // 实际API调用（需要配置API密钥）
            try {
                const response = await fetch('/api/llm/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        prompt: prompt,
                        context: context,
                        model: 'gpt-4',
                        temperature: 0.7,
                        max_tokens: 1000
                    })
                });

                return await response.json();
            } catch (error) {
                console.error('LLM API调用失败:', error);
                return this.generateMockResponse(prompt, context);
            }
        }

        generateMockResponse(prompt, context) {
            // 模拟智能响应
            const responses = this.getMockResponses(prompt, context);
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];

            return new Promise(resolve => {
                setTimeout(() => {
                    resolve({
                        success: true,
                        response: randomResponse,
                        timestamp: new Date().toISOString()
                    });
                }, 1000 + Math.random() * 2000); // 模拟1-3秒响应时间
            });
        }

        getMockResponses(prompt, context) {
            const promptLower = prompt.toLowerCase();

            // 监控中心相关响应
            if (promptLower.includes('监控') || promptLower.includes('报警状况') || promptLower.includes('当前状态')) {
                return [
                    "根据当前监控数据分析，系统整体运行稳定。发现以下关键信息：\n\n📊 **当前状况**\n- 活跃报警：12条，较昨日减少3条\n- 高优先级报警：2条，需要重点关注\n- 未确认报警：5条，建议及时处理\n\n⚠️ **重点关注**\n- R-2002反应器压力报警持续时间较长，建议检查设备状态\n- MTO装置温度波动频繁，可能需要调整控制参数\n\n💡 **建议措施**\n1. 优先处理高优先级报警\n2. 加强设备巡检频率\n3. 关注温度控制系统稳定性",

                    "智能分析显示当前报警管理状况良好，但存在几个需要注意的点：\n\n✅ **积极方面**\n- 报警确认及时率达到92%\n- 滋扰报警比例控制在15%以下\n- 系统响应时间正常\n\n🔍 **需要关注**\n- 80PIC11906标签报警频率偏高\n- 夜班时段处置效率略低\n- 部分报警存在间歇性特征\n\n📋 **行动建议**\n1. 检查80PIC11906传感器校准状态\n2. 加强夜班人员培训\n3. 分析间歇性报警的根本原因"
                ];
            }

            // 行动中心相关响应
            if (promptLower.includes('处置') || promptLower.includes('处理') || promptLower.includes('解决')) {
                return [
                    "基于报警特征和历史经验，为您提供智能处置建议：\n\n🔧 **处置方案**\n1. **立即措施**：确认报警并记录当前工艺参数\n2. **检查项目**：验证传感器读数，检查控制阀门状态\n3. **调整建议**：适当降低设定值，观察系统响应\n\n⏱️ **预期时间**\n- 确认时间：< 5分钟\n- 处置时间：15-30分钟\n- 恢复时间：预计1小时内\n\n⚠️ **风险评估**\n- 安全风险：低\n- 生产影响：轻微\n- 建议操作人员：有经验的工艺员",

                    "根据报警类型和当前工况，推荐以下处置流程：\n\n📋 **标准流程**\n1. 安全确认：确保人员和设备安全\n2. 现场检查：派遣操作人员现场确认\n3. 参数调整：根据工艺要求调整相关参数\n4. 效果验证：监控调整后的系统响应\n\n🎯 **关键要点**\n- 优先确保安全，避免急躁操作\n- 记录所有操作步骤和参数变化\n- 如15分钟内无改善，请联系工艺工程师\n\n📞 **联系信息**\n- 工艺工程师：内线8001\n- 设备工程师：内线8002\n- 安全管理员：内线8003"
                ];
            }

            // 通用问答
            if (promptLower.includes('什么') || promptLower.includes('如何') || promptLower.includes('为什么')) {
                return [
                    "根据您的问题，我来为您详细解答：\n\n💡 **专业解释**\n基于工业报警管理的最佳实践和系统当前状况，这个问题涉及多个技术层面。让我为您分析关键要点和解决方案。\n\n📚 **相关知识**\n- 工艺原理和控制逻辑\n- 设备运行特性\n- 历史经验和案例\n\n🔍 **具体建议**\n建议您查看相关技术文档，或咨询专业工程师获取更详细的指导。如需要，我可以为您提供更具体的操作步骤。",

                    "这是一个很好的问题！让我基于系统数据和专业知识为您解答：\n\n🎯 **核心要点**\n从技术角度来看，这个问题的关键在于理解系统的工作原理和当前的运行状态。\n\n📊 **数据支持**\n根据历史数据和当前监控信息，我们可以看到相关的趋势和模式。\n\n✅ **实用建议**\n建议采取渐进式的方法，先进行小范围测试，然后根据效果逐步扩大应用范围。同时要密切监控关键指标的变化。"
                ];
            }

            // 默认响应
            return [
                "感谢您的咨询！作为您的智能助手，我正在分析相关信息。\n\n🤖 **智能分析中**\n基于当前系统状态和您的问题，我建议：\n\n1. 查看相关监控数据\n2. 检查历史记录\n3. 参考最佳实践\n\n如需更具体的帮助，请提供更多详细信息，我将为您提供更精准的建议。",

                "我理解您的需求，让我为您提供专业的建议：\n\n📋 **当前建议**\n根据系统当前状况和您的问题，建议您：\n\n• 首先确认相关数据的准确性\n• 查看是否有类似的历史案例\n• 考虑采取预防性措施\n\n💬 **进一步交流**\n如果您需要更详细的解释或有其他问题，请随时告诉我。我会根据具体情况为您提供更有针对性的建议。"
            ];
        }
    }

    // 初始化LLM服务
    const llmService = new LLMService();

    // AI助手功能
    function initAIAssistant() {
        const trigger = document.getElementById('ai-assistant-trigger');
        const assistant = document.getElementById('ai-assistant');
        const closeBtn = document.getElementById('close-ai-assistant');
        const sendBtn = document.getElementById('send-chat');
        const chatInput = document.getElementById('chat-input');

        // 显示/隐藏助手
        trigger.addEventListener('click', () => {
            aiAssistantVisible = !aiAssistantVisible;
            if (aiAssistantVisible) {
                assistant.classList.remove('hidden');
                trigger.classList.add('hidden');
                chatInput.focus();
            }
        });

        closeBtn.addEventListener('click', () => {
            assistant.classList.add('hidden');
            trigger.classList.remove('hidden');
            aiAssistantVisible = false;
        });

        // 发送消息
        sendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // 快捷按钮
        document.getElementById('quick-status').addEventListener('click', () => {
            sendQuickMessage('请分析当前报警状况');
        });

        document.getElementById('quick-suggestion').addEventListener('click', () => {
            sendQuickMessage('请提供当前报警的处置建议');
        });

        document.getElementById('quick-help').addEventListener('click', () => {
            sendQuickMessage('如何使用这个系统？');
        });
    }

    async function sendMessage() {
        const chatInput = document.getElementById('chat-input');
        const message = chatInput.value.trim();

        if (!message || isAIProcessing) return;

        // 添加用户消息
        addChatMessage(message, 'user');
        chatInput.value = '';

        // 显示AI思考状态
        isAIProcessing = true;
        const thinkingId = addChatMessage('正在思考中...', 'ai', true);

        try {
            // 获取当前上下文
            const context = getCurrentContext();

            // 调用LLM服务
            const response = await llmService.generateResponse(message, context);

            // 移除思考消息
            removeChatMessage(thinkingId);

            // 添加AI回复
            if (response.success) {
                addChatMessage(response.response, 'ai');

                // 记录聊天历史
                chatHistory.push({
                    user: message,
                    ai: response.response,
                    timestamp: new Date(),
                    context: context
                });
            } else {
                addChatMessage('抱歉，我暂时无法回答您的问题。请稍后再试。', 'ai');
            }
        } catch (error) {
            console.error('AI助手错误:', error);
            removeChatMessage(thinkingId);
            addChatMessage('抱歉，服务暂时不可用。请稍后再试。', 'ai');
        } finally {
            isAIProcessing = false;
        }
    }

    function sendQuickMessage(message) {
        const chatInput = document.getElementById('chat-input');
        chatInput.value = message;
        sendMessage();
    }

    function addChatMessage(message, sender, isTemporary = false) {
        const chatMessages = document.getElementById('chat-messages');
        const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

        const messageDiv = document.createElement('div');
        messageDiv.id = messageId;
        messageDiv.className = `mb-4 ${sender === 'user' ? 'text-right' : 'text-left'}`;

        const isUser = sender === 'user';
        const bgColor = isUser ? 'bg-blue-600 text-white' : 'bg-white border border-gray-200';
        const alignment = isUser ? 'ml-auto' : 'mr-auto';

        messageDiv.innerHTML = `
            <div class="inline-block max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${bgColor} ${alignment}">
                ${isUser ?
                    `<div class="text-sm">${escapeHtml(message)}</div>` :
                    `<div class="text-sm whitespace-pre-line">${formatAIResponse(message)}</div>`
                }
                <div class="text-xs opacity-70 mt-1">
                    ${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}
                </div>
            </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        return messageId;
    }

    function removeChatMessage(messageId) {
        const message = document.getElementById(messageId);
        if (message) {
            message.remove();
        }
    }

    function formatAIResponse(text) {
        // 格式化AI响应，支持markdown样式
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/`(.*?)`/g, '<code class="bg-gray-100 px-1 rounded">$1</code>')
            .replace(/###\s*(.*?)$/gm, '<h3 class="font-bold text-lg mt-2 mb-1">$1</h3>')
            .replace(/##\s*(.*?)$/gm, '<h2 class="font-bold text-xl mt-2 mb-1">$1</h2>')
            .replace(/^-\s*(.*?)$/gm, '<li class="ml-4">• $1</li>')
            .replace(/^\d+\.\s*(.*?)$/gm, '<li class="ml-4">$1</li>');
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function getCurrentContext() {
        const activeSection = document.querySelector('.nav-item.active')?.dataset.target || 'monitoring';
        const context = {
            currentModule: activeSection,
            timestamp: new Date().toISOString()
        };

        // 根据当前模块添加相关上下文
        switch (activeSection) {
            case 'monitoring':
                context.alarmCount = document.querySelectorAll('.alarm-item').length;
                context.highPriorityCount = document.querySelectorAll('.alarm-item.high-priority').length;
                break;
            case 'action':
                context.pendingActions = document.querySelectorAll('.action-item.pending').length;
                break;
            case 'analysis':
                context.analysisType = 'trend_analysis';
                break;
            // 可以根据需要添加更多上下文
        }

        return context;
    }

    // 监控中心AI分析功能
    async function generateMonitoringInsights() {
        const insightsContainer = document.getElementById('ai-monitoring-insights');
        const contentDiv = document.getElementById('ai-monitoring-insights-content');

        insightsContainer.classList.remove('hidden');
        contentDiv.textContent = '正在分析当前监控数据...';

        try {
            // 收集当前监控数据
            const monitoringData = {
                totalAlarms: document.getElementById('kpi-total-alarms')?.textContent || '0',
                hourlyAlarms: document.getElementById('kpi-hourly-alarms')?.textContent || '0',
                peakRate: document.getElementById('kpi-peak-rate')?.textContent || '0',
                nuisanceAlarms: document.getElementById('kpi-nuisance-alarms')?.textContent || '0',
                nuisancePercent: document.getElementById('kpi-nuisance-percent')?.textContent || '0%',
                floodCount: document.getElementById('kpi-flood-count')?.textContent || '0',
                floodPercent: document.getElementById('kpi-flood-percent')?.textContent || '0%'
            };

            const prompt = `
            作为工业报警管理专家，请分析当前监控数据：

            📊 当前监控指标：
            - 总报警数: ${monitoringData.totalAlarms}
            - 小时报警数: ${monitoringData.hourlyAlarms}
            - 峰值报警率: ${monitoringData.peakRate}
            - 滋扰报警数: ${monitoringData.nuisanceAlarms}
            - 滋扰报警占比: ${monitoringData.nuisancePercent}
            - 报警泛滥次数: ${monitoringData.floodCount}
            - 报警泛滥比例: ${monitoringData.floodPercent}

            请提供专业的监控分析，包括：
            1. 当前状况评估
            2. 关键问题识别
            3. 风险预警
            4. 改进建议
            `;

            const response = await llmService.generateResponse(prompt, {
                module: 'monitoring',
                data: monitoringData
            });

            if (response.success) {
                contentDiv.innerHTML = formatAIResponse(response.response);
            } else {
                contentDiv.textContent = '分析失败，请稍后重试。';
            }
        } catch (error) {
            console.error('监控AI分析错误:', error);
            contentDiv.textContent = '分析服务暂时不可用，请稍后重试。';
        }
    }

    // 行动中心AI处置建议功能
    async function generateActionInsights() {
        const insightsContainer = document.getElementById('ai-action-insights');
        const contentDiv = document.getElementById('ai-action-insights-content');

        insightsContainer.classList.remove('hidden');
        contentDiv.textContent = '正在分析当前报警并生成处置建议...';

        try {
            // 收集当前行动中心数据
            const actionData = {
                totalAlarms: document.getElementById('action-kpi-total')?.textContent || '0',
                pendingAnalysis: document.getElementById('action-kpi-pending')?.textContent || '0',
                overdueAck: document.getElementById('action-kpi-overdue-ack')?.textContent || '0',
                overdueRes: document.getElementById('action-kpi-overdue-res')?.textContent || '0',
                ackRate: document.getElementById('action-kpi-ack-rate')?.textContent || '0%',
                resRate: document.getElementById('action-kpi-res-rate')?.textContent || '0%'
            };

            const prompt = `
            作为工业报警处置专家，请分析当前处置状况：

            📋 当前处置指标：
            - 总报警数: ${actionData.totalAlarms}
            - 待处置分析: ${actionData.pendingAnalysis}
            - 超时确认: ${actionData.overdueAck}
            - 超时处置: ${actionData.overdueRes}
            - 及时确认率: ${actionData.ackRate}
            - 及时处置率: ${actionData.resRate}

            请提供专业的处置建议，包括：
            1. 处置效率评估
            2. 优先级建议
            3. 具体处置步骤
            4. 预防措施
            `;

            const response = await llmService.generateResponse(prompt, {
                module: 'action',
                data: actionData
            });

            if (response.success) {
                contentDiv.innerHTML = formatAIResponse(response.response);
            } else {
                contentDiv.textContent = '分析失败，请稍后重试。';
            }
        } catch (error) {
            console.error('行动AI分析错误:', error);
            contentDiv.textContent = '分析服务暂时不可用，请稍后重试。';
        }
    }

    // 历史记录相关函数
    function initHistoryCenter() {
        if (chartsInitialized.history) return;

        // 初始化历史记录数据
        initHistoryRecords();

        // 设置默认时间范围
        setDefaultTimeRange();

        chartsInitialized.history = true;
    }

    function updateHistoryCenterUI() {
        try {
            // 应用筛选条件
            applyHistoryFilters();

            // 更新记录列表
            updateHistoryRecordsList();

            // 更新统计信息
            updateHistoryStatistics();

        } catch (error) {
            console.error('历史记录更新错误:', error);
        }
    }

    function initHistoryRecords() {
        // 生成模拟历史记录数据
        historyRecords = generateMockHistoryRecords(500); // 生成500条模拟记录
        filteredHistoryRecords = [...historyRecords];
    }

    function generateMockHistoryRecords(count) {
        const records = [];
        const tags = ['80PIC11906', '80TIC11907', '80LIC11908', '80FIC11909', '80AIC11910'];
        const tagNames = ['反应器压力', '反应器温度', '分离器液位', '进料流量', '分析仪'];
        const alarmTypes = ['high', 'low', 'deviation', 'system'];
        const alarmLevels = [1, 2, 3, 4];
        const units = ['MPa', '℃', '%', 'm³/h', 'ppm'];

        for (let i = 0; i < count; i++) {
            const tagIndex = Math.floor(Math.random() * tags.length);
            const alarmTime = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000); // 最近30天
            const ackTime = Math.random() > 0.3 ? new Date(alarmTime.getTime() + Math.random() * 3600000) : null; // 70%概率有确认时间
            const recoveryTime = Math.random() > 0.2 ? new Date(alarmTime.getTime() + Math.random() * 7200000) : null; // 80%概率有恢复时间
            const analysisTime = Math.random() > 0.4 ? new Date(alarmTime.getTime() + Math.random() * 86400000) : null; // 60%概率有分析时间
            const importTime = new Date(alarmTime.getTime() + Math.random() * 3600000);

            const threshold = 50 + Math.random() * 100;
            const triggerValue = threshold + (Math.random() - 0.5) * 20;
            const duration = recoveryTime ? recoveryTime - alarmTime : null;

            records.push({
                id: `record-${i + 1}`,
                tagNo: tags[tagIndex],
                tagName: tagNames[tagIndex],
                threshold: threshold.toFixed(2),
                triggerValue: triggerValue.toFixed(2),
                unit: units[tagIndex],
                alarmContent: `${tagNames[tagIndex]}${alarmTypes[Math.floor(Math.random() * alarmTypes.length)] === 'high' ? '高' : '低'}报警`,
                alarmLevel: alarmLevels[Math.floor(Math.random() * alarmLevels.length)],
                alarmTime: alarmTime,
                ackTime: ackTime,
                recoveryTime: recoveryTime,
                analysisTime: analysisTime,
                importTime: importTime,
                duration: duration,

                // 计算字段
                isAckTimeout: ackTime ? (ackTime - alarmTime) > 300000 : true, // 5分钟超时
                isResolveTimeout: recoveryTime ? (recoveryTime - alarmTime) > 1800000 : true, // 30分钟超时
                isFlash: duration ? duration < 3000 : false, // 3秒内为瞬闪
                isIntermittent: Math.random() > 0.8, // 20%概率为间歇
                isStale: duration ? duration > 86400000 : false, // 24小时以上为陈旧
                isRecovered: !!recoveryTime,
                isShelved: Math.random() > 0.95, // 5%概率被搁置
                includeInStatistics: true
            });
        }

        return records.sort((a, b) => b.alarmTime - a.alarmTime); // 按时间倒序
    }

    function setDefaultTimeRange() {
        const now = new Date();
        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

        document.getElementById('history-time-start').value = oneWeekAgo.toISOString().slice(0, 16);
        document.getElementById('history-time-end').value = now.toISOString().slice(0, 16);
    }

    function applyHistoryFilters() {
        const startTime = document.getElementById('history-time-start').value;
        const endTime = document.getElementById('history-time-end').value;
        const factoryFilter = document.getElementById('history-factory-filter').value;
        const tagFilter = document.getElementById('history-tag-filter').value.toLowerCase();
        const alarmTypeFilter = document.getElementById('history-alarm-type-filter').value;
        const alarmLevelFilter = document.getElementById('history-alarm-level-filter').value;
        const statusFilter = document.getElementById('history-status-filter').value;

        filteredHistoryRecords = historyRecords.filter(record => {
            // 时间筛选
            if (startTime && record.alarmTime < new Date(startTime)) return false;
            if (endTime && record.alarmTime > new Date(endTime)) return false;

            // 工厂模型筛选
            if (factoryFilter && !record.tagNo.includes(factoryFilter)) return false;

            // 标签筛选
            if (tagFilter && !record.tagNo.toLowerCase().includes(tagFilter) &&
                !record.tagName.toLowerCase().includes(tagFilter)) return false;

            // 报警类型筛选
            if (alarmTypeFilter && !record.alarmContent.includes(alarmTypeFilter === 'high' ? '高' : '低')) return false;

            // 报警等级筛选
            if (alarmLevelFilter && record.alarmLevel !== parseInt(alarmLevelFilter)) return false;

            // 状态筛选
            if (statusFilter) {
                switch (statusFilter) {
                    case 'unconfirmed':
                        if (record.ackTime) return false;
                        break;
                    case 'confirmed':
                        if (!record.ackTime || record.recoveryTime) return false;
                        break;
                    case 'resolved':
                        if (!record.recoveryTime || record.analysisTime) return false;
                        break;
                    case 'closed':
                        if (!record.analysisTime) return false;
                        break;
                }
            }

            return true;
        });

        // 重置分页
        currentHistoryPage = 1;
    }

    function updateHistoryRecordsList() {
        const pageSize = parseInt(document.getElementById('history-page-size').value);
        historyPageSize = pageSize;

        const startIndex = (currentHistoryPage - 1) * pageSize;
        const endIndex = startIndex + pageSize;
        const pageRecords = filteredHistoryRecords.slice(startIndex, endIndex);

        const tableBody = document.getElementById('history-records-list');
        if (!tableBody) return;

        const levelColors = {
            1: 'bg-red-100 text-red-800',
            2: 'bg-orange-100 text-orange-800',
            3: 'bg-yellow-100 text-yellow-800',
            4: 'bg-blue-100 text-blue-800'
        };

        tableBody.innerHTML = pageRecords.map(record => {
            const durationText = record.duration ? formatDuration(record.duration) : '-';
            const statusText = getStatusText(record);
            const statusColor = getStatusColor(record);

            return `
                <tr class="border-b hover:bg-slate-50">
                    <td class="p-3">
                        <input type="checkbox" class="rounded history-checkbox" data-id="${record.id}">
                    </td>
                    <td class="p-3 font-mono">${record.tagNo}</td>
                    <td class="p-3">${record.tagName}</td>
                    <td class="p-3">${record.threshold}</td>
                    <td class="p-3">${record.triggerValue}</td>
                    <td class="p-3">${record.unit}</td>
                    <td class="p-3">${record.alarmContent}</td>
                    <td class="p-3">
                        <span class="px-2 py-1 rounded text-xs ${levelColors[record.alarmLevel]}">
                            ${record.alarmLevel}级
                        </span>
                    </td>
                    <td class="p-3">${formatDateTime(record.alarmTime)}</td>
                    <td class="p-3">${record.ackTime ? formatDateTime(record.ackTime) : '-'}</td>
                    <td class="p-3">${record.recoveryTime ? formatDateTime(record.recoveryTime) : '-'}</td>
                    <td class="p-3">${durationText}</td>
                    <td class="p-3">
                        <span class="px-2 py-1 rounded text-xs ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="p-3">${formatDateTime(record.importTime)}</td>
                    <td class="p-3">
                        <button class="text-blue-600 hover:underline text-xs mr-2" onclick="viewHistoryRecord('${record.id}')">查看</button>
                        <button class="text-red-600 hover:underline text-xs" onclick="deleteHistoryRecord('${record.id}')">删除</button>
                    </td>
                </tr>
            `;
        }).join('');

        updateHistoryPagination();
    }

    function updateHistoryStatistics() {
        document.getElementById('total-records-count').textContent = historyRecords.length.toLocaleString();
        document.getElementById('filtered-records-count').textContent = filteredHistoryRecords.length.toLocaleString();
    }

    function updateHistoryPagination() {
        const totalRecords = filteredHistoryRecords.length;
        const totalPages = Math.ceil(totalRecords / historyPageSize);
        const startIndex = (currentHistoryPage - 1) * historyPageSize + 1;
        const endIndex = Math.min(currentHistoryPage * historyPageSize, totalRecords);

        document.getElementById('history-start').textContent = totalRecords > 0 ? startIndex : 0;
        document.getElementById('history-end').textContent = endIndex;
        document.getElementById('history-total').textContent = totalRecords;
        document.getElementById('history-page-info').textContent = `第 ${currentHistoryPage} 页，共 ${totalPages} 页`;

        // 更新分页按钮状态
        document.getElementById('history-first-page').disabled = currentHistoryPage === 1;
        document.getElementById('history-prev-page').disabled = currentHistoryPage === 1;
        document.getElementById('history-next-page').disabled = currentHistoryPage === totalPages;
        document.getElementById('history-last-page').disabled = currentHistoryPage === totalPages;
    }

    function formatDuration(duration) {
        const seconds = Math.floor(duration / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);

        if (days > 0) return `${days}天${hours % 24}时`;
        if (hours > 0) return `${hours}时${minutes % 60}分`;
        if (minutes > 0) return `${minutes}分${seconds % 60}秒`;
        return `${seconds}秒`;
    }

    function formatDateTime(date) {
        return date.toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
    }

    function getStatusText(record) {
        if (record.analysisTime) return '已关闭';
        if (record.recoveryTime) return '已处置';
        if (record.ackTime) return '已确认';
        return '未确认';
    }

    function getStatusColor(record) {
        if (record.analysisTime) return 'bg-gray-100 text-gray-800';
        if (record.recoveryTime) return 'bg-green-100 text-green-800';
        if (record.ackTime) return 'bg-blue-100 text-blue-800';
        return 'bg-red-100 text-red-800';
    }

    // 历史记录操作函数
    function viewHistoryRecord(recordId) {
        const record = historyRecords.find(r => r.id === recordId);
        if (record) {
            showNotification(`查看记录: ${record.tagNo} - ${record.alarmContent}`, 'info');
        }
    }

    function deleteHistoryRecord(recordId) {
        if (confirm('确定要删除这条历史记录吗？')) {
            historyRecords = historyRecords.filter(r => r.id !== recordId);
            applyHistoryFilters();
            updateHistoryRecordsList();
            updateHistoryStatistics();
            showNotification('记录删除成功', 'success');
        }
    }

    function importHistoryRecords() {
        showNotification('历史记录导入功能开发中...', 'info');
    }

    function exportHistoryRecords() {
        const selectedRecords = getSelectedHistoryRecords();
        if (selectedRecords.length === 0) {
            showNotification('请先选择要导出的记录', 'error');
            return;
        }
        showNotification(`导出 ${selectedRecords.length} 条记录`, 'success');
    }

    function batchCalculateHistory() {
        const selectedRecords = getSelectedHistoryRecords();
        if (selectedRecords.length === 0) {
            showNotification('请先选择要计算的记录', 'error');
            return;
        }

        // 模拟批量计算过程
        showNotification('开始批量计算...', 'info');
        setTimeout(() => {
            showNotification(`批量计算完成，处理了 ${selectedRecords.length} 条记录`, 'success');
        }, 2000);
    }

    function batchDeleteHistory() {
        const selectedRecords = getSelectedHistoryRecords();
        if (selectedRecords.length === 0) {
            showNotification('请先选择要删除的记录', 'error');
            return;
        }

        if (confirm(`确定要删除选中的 ${selectedRecords.length} 条记录吗？`)) {
            const selectedIds = selectedRecords.map(r => r.id);
            historyRecords = historyRecords.filter(r => !selectedIds.includes(r.id));
            applyHistoryFilters();
            updateHistoryRecordsList();
            updateHistoryStatistics();
            showNotification(`已删除 ${selectedRecords.length} 条记录`, 'success');
        }
    }

    function getSelectedHistoryRecords() {
        const selectedCheckboxes = document.querySelectorAll('.history-checkbox:checked');
        const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.id);
        return filteredHistoryRecords.filter(r => selectedIds.includes(r.id));
    }
});
</script>

<!-- AI智能助手 -->
<div id="ai-assistant" class="fixed bottom-4 right-4 w-96 bg-white rounded-lg shadow-2xl border border-slate-200 z-50 hidden">
    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-t-lg">
        <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <h3 class="font-semibold">AI智能助手</h3>
        </div>
        <button id="close-ai-assistant" class="text-white hover:text-gray-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    <div id="chat-messages" class="h-80 overflow-y-auto p-4 bg-gray-50">
        <div class="text-center text-sm text-gray-500 mb-4">
            👋 您好！我是您的智能助手，可以帮您分析报警状况、提供处置建议。请问有什么可以帮助您的吗？
        </div>
    </div>

    <div class="p-4 border-t bg-white rounded-b-lg">
        <div class="flex gap-2">
            <input type="text" id="chat-input" placeholder="输入您的问题..."
                   class="flex-1 p-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="send-chat" class="bg-blue-600 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-blue-700 disabled:opacity-50">
                发送
            </button>
        </div>
        <div class="flex items-center gap-4 mt-2 text-xs text-gray-500">
            <button id="quick-status" class="hover:text-blue-600">当前状况分析</button>
            <button id="quick-suggestion" class="hover:text-blue-600">处置建议</button>
            <button id="quick-help" class="hover:text-blue-600">使用帮助</button>
        </div>
    </div>
</div>

<!-- AI助手触发按钮 -->
<button id="ai-assistant-trigger" class="fixed bottom-4 right-4 w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 z-40 flex items-center justify-center">
    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
    </svg>
</button>

</body>
</html>
